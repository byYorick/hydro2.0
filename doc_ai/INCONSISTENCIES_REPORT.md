# Отчет о несоответствиях в проекте hydro2.0

Дата анализа: 2025-01-27

## Резюме

Обнаружены несоответствия между документацией (`doc_ai/`) и реальной структурой проекта. Основные проблемы:
- Расхождения в структуре документации
- Упоминания несуществующих сервисов
- Несоответствия в структуре firmware
- Отсутствующие документы

---

## 1. Структура документации

### Проблема
В документации упоминается папка `docs/`, но основная документация находится в `doc_ai/`.

**Где найдено:**
- `doc_ai/01_SYSTEM/01_PROJECT_STRUCTURE_PROD.md` (строки 29, 45, 279, 325)
- `doc_ai/04_BACKEND_CORE/FULL_STACK_DEPLOY_DOCKER.md` (строка 31)

**Реальная структура:**
- Основная документация находится в `doc_ai/`
- В корне проекта есть папка `docs/`, которая является "mirror" структуры из `doc_ai/` (согласно `docs/README.md`)
- `README.md` в корне упоминает `docs/`, но ссылается на `doc_ai/01_SYSTEM/01_PROJECT_STRUCTURE_PROD.md`

**Рекомендация:**
- Уточнить в документации: `docs/` — это mirror или основная папка?
- Обновить ссылки в документации для единообразия
- Или явно указать, что `doc_ai/` — основная папка, а `docs/` — mirror

---

## 2. Сервис api-gateway

### Проблема
В документации упоминается отдельный сервис `api-gateway`, но в реальности используется Laravel как единый backend.

**Где найдено:**
- `doc_ai/01_SYSTEM/01_PROJECT_STRUCTURE_PROD.md` (строка 154): упоминается `api-gateway/` как HTTP API для мобилки и UI
- `backend/README.md` (строка 1): упоминается в списке сервисов
- `backend/services/api-gateway/` существует, но содержит только заглушку

**Реальная структура:**
- В `backend/docker-compose.dev.yml` нет сервиса `api-gateway`
- Используется `laravel` как единый backend с REST API
- Laravel предоставляет все API эндпоинты через `/api/*`

**Рекомендация:**
- Обновить документацию: указать, что Laravel выполняет роль api-gateway
- Удалить или переименовать `backend/services/api-gateway/` (если не планируется отдельный сервис)
- Обновить `backend/README.md`

---

## 3. Сервис device-registry

### Проблема
Сервис `device-registry` упоминается в документации и docker-compose.prod.yml, но реализован только как заглушка.

**Где найдено:**
- `doc_ai/01_SYSTEM/01_PROJECT_STRUCTURE_PROD.md` (строка 164): упоминается как реестр устройств
- `backend/docker-compose.prod.yml` (строка 17): есть сервис device-registry
- `backend/services/device-registry/README.md`: только заглушка
- `backend/services/device-registry/Dockerfile`: только placeholder

**Реальная структура:**
- Сервис существует, но не реализован
- Функционал device-registry, вероятно, реализован в Laravel (модели Device, DeviceNode)

**Рекомендация:**
- Либо реализовать device-registry как отдельный Python-сервис
- Либо удалить упоминания из документации и docker-compose, если функционал полностью в Laravel
- Обновить `IMPLEMENTATION_STATUS.md` с корректным статусом

---

## 4. Отсутствующий документ PYTHON_SERVICES_ARCH.md

### Проблема
В `IMPLEMENTATION_STATUS.md` упоминается документ `PYTHON_SERVICES_ARCH.md`, но он не существует.

**Где найдено:**
- `doc_ai/IMPLEMENTATION_STATUS.md` (строка 93): 
  ```
  - [x] Общая архитектура Python-сервисов описана (`PYTHON_SERVICES_ARCH.md` или аналог) — **SPEC_READY**
  ```

**Реальная структура:**
- Файл `PYTHON_SERVICES_ARCH.md` отсутствует
- Есть `backend/services/README.md`, но он описывает только текущую реализацию, не архитектуру

**Рекомендация:**
- Создать документ `doc_ai/04_BACKEND_CORE/PYTHON_SERVICES_ARCH.md` с описанием архитектуры Python-сервисов
- Или обновить `IMPLEMENTATION_STATUS.md`, указав реальный документ (например, `backend/services/README.md`)

---

## 5. Структура firmware нод

### Проблема
В документации упоминаются ноды `ph_node`, `ec_node`, `climate_node`, но в реальности реализована только `pump_node` (и то как заглушка).

**Где найдено:**
- `doc_ai/01_SYSTEM/01_PROJECT_STRUCTURE_PROD.md` (строки 112-128): описана структура для ph_node, ec_node, climate_node
- `firmware/README.md` (строка 5): упоминаются все типы нод
- `doc_ai/IMPLEMENTATION_STATUS.md` (раздел 2): описаны планы по всем нодам

**Реальная структура:**
- В `firmware/nodes/` существует только `pump_node/`
- `pump_node` содержит только placeholder-код
- Ноды `ph_node`, `ec_node`, `climate_node` отсутствуют

**Рекомендация:**
- Обновить `firmware/README.md`, указав реальное состояние
- Создать структуру для остальных нод (хотя бы скелеты)
- Или обновить документацию, указав, что это планы, а не реализация

---

## 6. Общие компоненты firmware

### Проблема
В документации упоминаются общие компоненты (i2c_bus, ina209, oled_display и т.д.), но они не реализованы.

**Где найдено:**
- `doc_ai/01_SYSTEM/01_PROJECT_STRUCTURE_PROD.md` (строки 90-100): описана структура `firmware/common/components/`
- `firmware/common/components/README.md`: перечислены компоненты, но они не реализованы

**Реальная структура:**
- `firmware/common/components/` существует, но содержит только `README.md`
- Компоненты не реализованы

**Рекомендация:**
- Обновить `firmware/common/components/README.md`, указав статус (PLANNED вместо реализованных)
- Или создать скелеты компонентов

---

## 7. Структура backend/services

### Проблема
В документации упоминается структура с `src/` и `tests/`, но реальная структура проще.

**Где найдено:**
- `doc_ai/01_SYSTEM/01_PROJECT_STRUCTURE_PROD.md` (строки 154-167): описана структура с `src/`, `tests/`

**Реальная структура:**
- Python-сервисы имеют плоскую структуру: `main.py`, `requirements.txt`, `Dockerfile`, `README.md`
- Нет папок `src/` и `tests/` (кроме `automation-engine/test_main.py` и `scheduler/test_main.py`)

**Рекомендация:**
- Обновить документацию, отразив реальную структуру
- Или реорганизовать сервисы согласно документации

---

## 8. Несоответствия в IMPLEMENTATION_STATUS.md

### Проблема
Статусы реализации в `IMPLEMENTATION_STATUS.md` могут не соответствовать реальности.

**Примеры:**
- Строка 94: `history-logger` — **MVP_DONE**, но нужно проверить полноту реализации
- Строка 95: `automation-engine` — **MVP_DONE**, реализован
- Строка 96: `scheduler` — **MVP_DONE**, реализован
- Строка 97: `mqtt-bridge` — **MVP_DONE**, реализован
- Строка 106: Модели зон, нод, рецептов — **MVP_DONE** (реализовано в Laravel)
- Строка 107: REST API v1 — **MVP_DONE** (реализовано в Laravel)

**Рекомендация:**
- Провести аудит статусов в `IMPLEMENTATION_STATUS.md`
- Обновить статусы согласно реальному состоянию кода

---

## 9. Отсутствие документации по структуре mobile

### Проблема
В документации упоминается структура мобильного приложения, но может не соответствовать реальности.

**Где найдено:**
- `doc_ai/01_SYSTEM/01_PROJECT_STRUCTURE_PROD.md` (строки 201-216): описана структура `mobile/`

**Реальная структура:**
- `mobile/app/android/` содержит Android-приложение на Kotlin
- Структура соответствует описанию, но нужно проверить детали

**Рекомендация:**
- Проверить соответствие реальной структуры документации
- Обновить при необходимости

---

## 10. Отсутствующий документ NODE_CONFIG_SPEC.md

### Проблема
В документации упоминается `NODE_CONFIG_SPEC.md`, но файл не существует.

**Где найдено:**
- `doc_ai/01_SYSTEM/01_PROJECT_STRUCTURE_PROD.md` (строка 279):
  ```
  структура которого описана в `docs/02_HARDWARE_FIRMWARE/NODE_CONFIG_SPEC.md`
  ```

**Реальная структура:**
- Файл `NODE_CONFIG_SPEC.md` отсутствует в `doc_ai/02_HARDWARE_FIRMWARE/`
- Возможно, информация о NodeConfig разбросана по другим документам

**Рекомендация:**
- Создать документ `doc_ai/02_HARDWARE_FIRMWARE/NODE_CONFIG_SPEC.md`
- Или обновить ссылку, указав реальный документ с описанием NodeConfig

---

## 11. Ссылки на несуществующие документы

### Проблема
В документации могут быть ссылки на несуществующие файлы.

**Рекомендация:**
- Провести полный аудит всех ссылок в документации
- Проверить существование всех упоминаемых файлов
- Обновить или удалить битые ссылки

---

## Приоритеты исправления

### Высокий приоритет:
1. Уточнить структуру документации (`docs/` vs `doc_ai/`) и обновить ссылки
2. Обновить документацию по `api-gateway` (указать, что это Laravel)
3. Обновить статус `device-registry` в документации
4. Создать или обновить `PYTHON_SERVICES_ARCH.md`
5. Создать `NODE_CONFIG_SPEC.md` или обновить ссылку

### Средний приоритет:
6. Обновить документацию по структуре firmware (указать реальное состояние)
7. Обновить `IMPLEMENTATION_STATUS.md` с корректными статусами
8. Обновить структуру backend/services в документации

### Низкий приоритет:
9. Создать скелеты для отсутствующих нод firmware
10. Проверить все ссылки в документации

---

## Заключение

Основные несоответствия связаны с:
- Расхождением между планируемой и реальной архитектурой
- Неполной реализацией некоторых компонентов
- Устаревшими ссылками в документации

Рекомендуется провести систематический аудит всей документации и синхронизировать её с реальной структурой проекта.

