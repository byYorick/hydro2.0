# REST_API_REFERENCE.md
# Полный референс REST API для системы 2.0

Документ служит **справочником** по основным REST-эндпоинтам Laravel-backend,
которые используются фронтендом, Android и Python-сервисом (частично).

Он дополняет `API_SPEC_FRONTEND_BACKEND_FULL.md`, но сфокусирован именно на списке URL и их назначении.

---

## 1. Auth

| Метод | Путь | Описание |
|-------|---------------------|-----------------------------------|
| POST | /api/auth/login | Вход, выдача токена |
| POST | /api/auth/logout | Выход, отзыв токена |
| GET | /api/auth/me | Инфо о текущем пользователе |

---

## 2. Greenhouses

| Метод | Путь | Описание |
|-------|-------------------------|-------------------------------|
| GET | /api/greenhouses | Список теплиц |
| POST | /api/greenhouses | Создать теплицу |
| GET | /api/greenhouses/{id} | Детали теплицы |
| PATCH | /api/greenhouses/{id} | Обновить теплицу |
| DELETE| /api/greenhouses/{id} | Удалить (если безопасно) |

---

## 3. Zones

| Метод | Путь | Описание |
|-------|-----------------------|------------------------------------------------|
| GET | /api/zones | Список зон (фильтры по теплице, статусу) |
Доп. публичные чтения (MVP):

| Метод | Путь | Описание |
|-------|-----------------------|------------------------------|
| GET | /api/zones | Список зон (id, name, status, crop, phase) |

| POST | /api/zones | Создать зону |
| GET | /api/zones/{id} | Детали зоны + активный рецепт |
| PATCH | /api/zones/{id} | Обновить параметры зоны |
| DELETE| /api/zones/{id} | Удалить зону (если нет активных зависимостей) |

Доп. действия:

| Метод | Путь | Описание |
|-------|-----------------------------------|------------------------------------|
| POST | /api/zones/{id}/attach-recipe | Назначить рецепт |
| POST | /api/zones/{id}/change-phase | Сменить фазу рецепта |
| POST | /api/zones/{id}/commands | Отправить команду зоне |
| GET | /api/zones/{id}/telemetry/last | Последняя телеметрия |
| GET | /api/zones/{id}/telemetry/history| История телеметрии по метрикам |

---

## 4. Nodes

| Метод | Путь | Описание |
|-------|----------------------|-----------------------------------------------|
| GET | /api/nodes | Список узлов |
| POST | /api/nodes | Зарегистрировать узел |
| GET | /api/nodes/{id} | Детали узла |
| PATCH | /api/nodes/{id} | Обновить конфигурацию |
| DELETE| /api/nodes/{id} | Удалить узел |

Доп. действия:

| Метод | Путь | Описание |
|-------|------------------------------------|--------------------------------------------------|
| GET | /api/nodes/{id}/telemetry/last | Последняя телеметрия по узлу |
| POST | /api/nodes/{id}/commands | Отправка низкоуровневых команд |

---

## 5. Recipes

| Метод | Путь | Описание |
|-------|--------------------------|-------------------------------------|
| GET | /api/recipes | Список рецептов |
| POST | /api/recipes | Создать рецепт |
| GET | /api/recipes/{id} | Детали рецепта |
| PATCH | /api/recipes/{id} | Обновить рецепт |
| DELETE| /api/recipes/{id} | Удалить рецепт |

### Фазы рецептов

| Метод | Путь | Описание |
|-------|-------------------------------|------------------------------------|
| POST | /api/recipes/{id}/phases | Добавить фазу |
| PATCH | /api/recipe-phases/{id} | Обновить фазу |
| DELETE| /api/recipe-phases/{id} | Удалить фазу |

---

## 6. Telemetry / History

| Метод | Путь | Описание |
|-------|----------------------------------------------|-----------------------------------------------|
| GET | /api/zones/{id}/telemetry/last | Последние значения по зоне |
| GET | /api/zones/{id}/telemetry/history | История по зоне |
| GET | /api/nodes/{id}/telemetry/last | Последние значения по узлу |

---

## 7. Alerts / Events

| Метод | Путь | Описание |
|-------|------------------------------|-----------------------------------|
| GET | /api/alerts | Список алертов |
| GET | /api/alerts/{id} | Детали алерта |
| PATCH | /api/alerts/{id}/ack | Подтвердить/принять алерт (auth, role operator/admin) |
| GET | /api/alerts/stream | Server-Sent Events поток алертов |

---

## 8. Users (Admin only)

| Метод | Путь | Описание |
|-------|--------------------------|-------------------------------------|
| GET | /api/users | Список пользователей (фильтры: role, search) |
| POST | /api/users | Создать пользователя |
| GET | /api/users/{id} | Детали пользователя |
| PATCH | /api/users/{id} | Обновить пользователя (имя, email, пароль, роль) |
| DELETE| /api/users/{id} | Удалить пользователя |

---

## 9. System / AI / Service

| Метод | Путь | Описание |
|-------|---------------------------------|-------------------------------------------|
| GET | /api/system/config/full | Экспорт полной конфигурации |
| GET | /api/system/health | Проверка здоровья сервиса |

---

## 10. Admin (минимальный CRUD)

| Метод | Путь | Описание |
|-------|----------------------------------------|-------------------------------------------|
| POST | /api/admin/zones/quick-create | Быстрое создание зоны (role: admin) |
| PATCH | /api/admin/recipes/{id}/quick-update | Быстрое обновление рецепта (role: admin) |

---

## 11. Python integration

| Метод | Путь | Описание |
|-------|-------------------------------------|-------------------------------------------|
| POST | /api/python/ingest/telemetry | Инжест телеметрии из Python‑сервисов (token) |
| POST | /api/python/commands/ack | ACK выполнения команд узлами (token) |

---

## 12. Правила расширения REST API для ИИ-агентов

1. **Не менять семантику существующих путей и HTTP-методов.**
2. Для принципиально новых возможностей — добавлять новые пути
 (или версию `/api/v2/ ` при необходимости).
3. Любой новый публичный эндпоинт должен быть:
 - описан здесь;
 - интегрирован в `API_SPEC_FRONTEND_BACKEND_FULL.md`;
 - покрыт базовыми тестами.
4. Все действия, влияющие на физическое оборудование,
 должны проходить через Python-сервис, а не напрямую в MQTT.

Этот документ должен использоваться как **справочник** и основа для автодокументации (например, Swagger).
