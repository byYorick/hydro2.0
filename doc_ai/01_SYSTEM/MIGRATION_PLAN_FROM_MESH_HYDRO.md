# MIGRATION_PLAN_FROM_MESH_HYDRO.md
# План миграции с существующей системы (mesh_hydro 1.x) на Hydro 2.0

Документ описывает общий подход к миграции:

- существующих установок/теплиц,
- данных и конфигураций,
- узлов и рецептов

с системы mesh_hydro 1.x на новую архитектуру Hydro 2.0.

---

## 1. Цели миграции

1. Максимально использовать существующее оборудование, если возможно.
2. Сохранить критически важные исторические данные (телеметрия, настройки).
3. Переехать на новую архитектуру без длительных простоев.

---

## 2. Классы объектов для миграции

1. **Теплицы и зоны**
 - логическая структура (какие зоны, какие культуры).
2. **Узлы и устройства**
 - какие ноды стоят, какие датчики/исполнители подключены.
3. **Рецепты**
 - режимы и целевые значения для выращивания (pH, EC, t°, свет).
4. **Исторические данные**
 - временные ряды измерений,
 - логи алертов.

---

## 3. Стратегия миграции

Рекомендуемый подход: **поэтапная, зона за зоной**.

1. Подготовка backend 2.0 и его инфраструктуры.
2. Создание «параллельной» модели зон/теплиц в 2.0.
3. Поочерёдная замена узлов/контроллеров в каждой зоне:
 - либо прошивкой существующих устройств,
 - либо установкой новых нод.

---

## 4. Миграция узлов

### 4.1. Повторное использование железа

Если железо совместимо:

- на существующие ESP32-ноды шьётся прошивка 2.0;
- при этом:
 - hardware-ID (MAC) остаётся прежним;
 - логический ID может быть привязан заново.

### 4.2. Маппинг ролей

В старой системе:

- нода могла быть «комбайном» pH+EC+климат.

В новой системе:

- функции могут быть разделены по отдельным узлам.
- Необходимо:
 - описать, какие функции уходят на какую ноду,
 - обновить зонные контроллеры/рецепты.

---

## 5. Миграция рецептов и настроек

1. Для каждой культуры/зоны:
 - собрать текущие настройки (целевые pH, EC, t°, графики освещения).
2. Сопоставить их с моделью рецептов 2.0 (`RECIPE_ENGINE_FULL.md`).
3. Создать рецепты 2.0:
 - либо через миграционный скрипт,
 - либо вручную (при небольшом количестве зон).

---

## 6. Миграция телеметрии

Исторические данные можно:

1. Экспортировать из старой БД/хранилища.
2. Импортировать в новое хранилище в виде:
 - «исторического слоя»,
 - с возможной конвертацией форматов.

Если миграция телеметрии трудозатратна, допустимо хранить её
в «архивной» БД, доступной только для анализа, а в 2.0 собирать новые данные.

---

## 7. Параллельная эксплуатация и откат

На время миграции допускается:

- параллельная работа старой и новой систем для разных зон;
- при необходимости — возможность отката на старую систему
 (если железо и архитектура это позволяют).

---

## 8. Требования к ИИ-агенту

1. ИИ должен учитывать, что в системе может временно сосуществовать
 старый и новый стек — не предполагать «чистый лист».
2. Любые изменения, влияющие на миграцию (новые поля, изменение контрактов),
 должны быть отражены в этом документе.
