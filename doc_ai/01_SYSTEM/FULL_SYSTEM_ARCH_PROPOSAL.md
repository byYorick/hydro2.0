# FULL_SYSTEM_ARCH_PROPOSAL.md
# Предложение новой архитектуры системы 2.0
# Полный рефакторинг: ESP32 • MQTT • Python • Laravel • Vue • Docker • AI Integration

Документ описывает **архитектуру следующего поколения — 2.0**, 
которая эволюционирует систему 2.0 и решает ключевые ограничения.

Цель — создать:
- масштабируемую,
- модульную,
- безопасную,
- распределённую,
- умную (AI-driven)
гидропонную платформу.


Compatible-With: Protocol 2.0, Backend >=3.0, Python >=3.0, Database >=3.0, Frontend >=3.0.
Breaking-change: legacy форматы/алиасы удалены, обратная совместимость не поддерживается.

---

# 1. Основные недостатки 2.0, которые решает 2.0

1. **Слишком много логики в Python Scheduler** 
 → В 2.0 контроллеры становятся модульными микросервисами.

2. **Отсутствие стандартизированного AI‑слоя** 
 → В 2.0 AI получает выделенный сервис.

3. **Слабая изоляция MQTT** 
 → В 2.0 вводится строгая ACL + namespace.

4. **Нет событийного ядра** 
 → Вводится Event Bus + Webhooks.

5. **Нет автоматической масштабируемости** 
 → 2.0 работает как набор микросервисов, каждый можно масштабировать.

6. **UI статический** 
 → В 2.0 — real‑time панели WebSockets Everywhere.

---

# 2. Общее устройство системы 2.0

```
 ┌─────────────────────────┐
 │ ESP32 Узлы 2.0 │
 │ pH, EC, Climate, Irrig │
 └─────────────┬───────────┘
 MQTT
 │
┌─────────────────────────────────────────────────────────┐
│ CORE LAYER │
│ │
│ ┌──────────────────────────────┐ │
│ │ Python Telemetry Service │ ← telemetry │
│ └──────────────────────────────┘ │
│ │
│ ┌──────────────────────────────┐ │
│ │ Command Dispatcher Service │ → commands │
│ └──────────────────────────────┘ │
│ │
│ ┌──────────────────────────────┐ │
│ │ Zone Controllers Service │ ← targets │
│ └──────────────────────────────┘ │
│ │
│ ┌──────────────────────────────┐ │
│ │ Event & Alerts Engine │ │
│ └──────────────────────────────┘ │
│ │
└─────────────────────────────────────────────────────────┘

 ┌──────────────────────────┐
 │ PostgreSQL Data Layer │
 └──────────────────────────┘

 ┌──────────────────────────┐
 │ AI Optimization Layer │
 │ (LLM + Controllers AI) │
 └──────────────────────────┘

 ┌──────────────────────────┐
 │ Laravel API Backend │
 └──────────────────────────┘

 ┌──────────────────────────┐
 │ Vue 3 / Inertia UI │
 └──────────────────────────┘
