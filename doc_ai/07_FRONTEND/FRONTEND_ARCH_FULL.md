# FRONTEND_ARCH_FULL.md
# Полная архитектура Frontend 2.0 (UI/UX + функционал, детальная версия)
# **ОБНОВЛЕНО ПОСЛЕ МЕГА-РЕФАКТОРИНГА 2025-12-25**

Этот документ описывает полный, детальный и расширенный фронтенд системы управления теплицей 2.0.

**КЛЮЧЕВЫЕ ИЗМЕНЕНИЯ ПОСЛЕ РЕФАКТОРИНГА:**
- ✅ Новый мастер создания циклов (`GrowCycles/Wizard.vue`)
- ✅ Центр циклов (`Cycles/Center.vue`) с управлением GrowCycle
- ✅ Версионирование рецептов в UI
- ✅ Удалены legacy компоненты (AttachRecipeModal, etc.)
- ✅ Новые API endpoints для циклов и ревизий 
Здесь собраны принципы UI/UX, структура интерфейса, экраны, реалтайм-механики, компоненты, state‑management, интеграция с backend и ИИ.


Compatible-With: Protocol 2.0, Backend >=3.0, Python >=3.0, Database >=3.0, Frontend >=3.0.
Breaking-change: legacy форматы/алиасы удалены, обратная совместимость не поддерживается.

---

# 1. Цели и принципы UI/UX

## 1.1. Главная цель фронтенда
Создать **современную профессиональную панель управления агросистемой**, которая:

- работает в реалтайме,
- помогает оператору быстро реагировать на события,
- даёт инженеру глубокую диагностику оборудования,
- даёт агроному инструменты для работы с культурами и рецептами,
- расширяется под новые зоны, устройства, фичи,
- интегрируется с ИИ (подсказки, оптимизация, автоматизация процессов).

---

## 1.2. Основные UX-принципы

### ✔ Интуитивная трёхколоночная структура
```
[Навигация] | [Контент] | [Контекст/панель событий]
```

### ✔ Единая визуальная система статусов
- **зелёный** — OK 
- **жёлтый** — WARNING 
- **красный** — ALARM 
- **серый** — OFFLINE / PAUSED / SETUP

### ✔ Реалтайм-обновления без перезагрузки
WebSocket → обновление данных зон / нод / алертов / telemetry.

### ✔ Command Palette (Ctrl+K)
Как в VS Code:
- быстрые действия,
- поиск зон, нод, рецептов,
- “поставить зону 5 на паузу”,
- “открыть ноду nd-ph-3”.

### ✔ Тёмная тема по умолчанию
Профессиональный, современный интерфейс.

---

# 2. Основные разделы фронтенда

1. **Dashboard** (`/`) – ролевые дашборды с общим обзором
2. **Greenhouses** (`/greenhouses/create`) – создание теплиц
3. **Zones** (`/zones`) – список всех зон теплицы
4. **Zone Detail** (`/zones/{id}`) – *главный рабочий экран*
5. **Devices** (`/devices`) – узлы ESP, каналы, диагностика
6. **Recipes** (`/recipes`) – рецепты выращивания и культуры
7. **Alerts** (`/alerts`) – алерты и события
8. **Settings** (`/settings`) – настройки системы
9. **Admin** (`/admin`) – административная панель (для админов)
10. **Profile** (`/profile`) – профиль пользователя
11. **Setup** (`/setup/wizard`) – мастер первоначальной настройки

---

# 3. Подробное описание экранов

# 3.1. Dashboard

**Файл:** `Pages/Dashboard/Index.vue`

### Реализация:
- **Ролевые дашборды:** система автоматически показывает специализированный дашборд в зависимости от роли пользователя:
  - `AgronomistDashboard` - для агрономов (фокус на рецептах и аналитике)
  - `AdminDashboard` - для администраторов (полный контроль системы)
  - `EngineerDashboard` - для инженеров (диагностика устройств)
  - `OperatorDashboard` - для операторов (мониторинг зон)
  - `ViewerDashboard` - для наблюдателей (только просмотр)
  - Дефолтный дашборд - для пользователей без роли

### Содержимое (общее для всех ролей):
- Общее состояние теплицы:
 - количество зон RUNNING / PAUSED / ALARM
 - количество узлов ONLINE / OFFLINE
- Последние алерты
- Последние события (Events)
- Проблемные зоны
- Список теплиц

---

# 3.2. Zones (список зон)

### Карточка зоны показывает:
- название
- статус (цвет + иконка)
- тип зоны (production, tank, irrigation…)
- культура + фаза
- pH / EC (если есть бак)
- температура / влажность (если климат)
- уровень воды / освещение

### Фильтры:
- по статусу
- по типу
- по культуре
- по активности (запущенные/на паузе)

### Действия:
- открыть Zone Detail
- закрепить в избранные (pin)
- быстрые действия:
 - pause/resume
 - manual irrigation

---

# 3.3. Zone Detail – главный экран системы

## 3.3.1. Верхний блок (Header)
- Название зоны
- Теплица
- Фаза роста, культура, рецепт
- День фазы / процент прогресса
- Статус
- Кнопки:
 - Pause / Resume
 - Service Mode
 - Apply Recipe
 - Next Phase
 - Open Device List

---

## 3.3.2. Target vs Actual (основная метрика зоны)

Карточки:

### pH
- цель: 5.8 
- диапазон: 5.6 – 6.0 
- факт: 5.9 
- индикатор: зелёный/жёлтый/красный 

### EC
- цель: 1.6 
- диапазон: 1.4 – 1.8 
- факт: 1.5 

### Температура / Влажность
- цели vs факт 
- индикаторы 

### Свет
- часы света план / факт 
- текущая интенсивность 

### Уровень воды / проток / давление

---

## 3.3.3. Графики (Charts)
Tabs:

- pH
- EC
- Температура
- Влажность
- Деятельность насосов / вентиляторов
- Свет (интенсивность + часы)

История:
- 24 часа
- 7 дней
- 30 дней

---

## 3.3.4. Devices зоны

### Таблица устройств:
- Node ID 
- Статус ONLINE/OFFLINE 
- Каналы: ph_sensor, pump_acid, fan_A, heater… 
- RSSI Wi-Fi 
- FW версия 
- Кнопка → Device Detail 

---

## 3.3.5. Cycles (расписание)

Для каждой подсистемы:

- PH_CONTROL 
- EC_CONTROL 
- IRRIGATION 
- LIGHTING 
- CLIMATE 

Каждый цикл:
- strategy: periodic / event / hybrid 
- interval 
- last run 
- next run 
- кнопка “Запустить сейчас”

---

## 3.3.6. Actions (действия)

- Ручной полив (секунды)
- Принудительное измерение pH/EC
- Применить рецепт
- Сменить фазу
- Остановить / запустить зону
- Обнулить ALARM

---

## 3.3.7. Events (лог зоны)

Каждое событие:
- timestamp 
- тип (ALERT / INFO / ACTION / SENSOR) 
- текст:
 - “pH скорректирован на +1.5 мл base”
 - “Узел nd-ph-1 OFFLINE”
 - “Manual irrigation by user” 

Фильтры по типу, дате, пользователю.

---

# 3.4. Devices (Nodes)

## Device List
Столбцы:

- node_id
- зона
- статус
- RSSI (уровень Wi‑Fi)
- FW версия
- uptime
- last seen
- тип узла (ph, ec, climate…)

## Device Detail
Содержимое:

### 1. Основная информация:
- модель платы 
- ревизия 
- прошивка 
- IP, RSSI 

### 2. Каналы:
- имя канала 
- тип (SENSOR/ACTUATOR) 
- последнее значение (для сенсоров) 
- управление (для актуаторов) 
- безопасные ограничения 

### 3. NodeConfig:
- текущий JSON 
- кнопка “Переслать конфиг”

### 4. Диагностика:
- история ONLINE/OFFLINE 
- ошибки 

---

# 3.5. Recipes & Crops

## Recipe List (представление карточками)
- название
- культура
- версия
- количество фаз

## Recipe Detail
### Блоки:
1. Основные данные 
2. Фазы роста
3. Диапазоны pH/EC/t°/RH
4. Циклы подсистем
5. Привязанные зоны
6. Кнопки:
 - применить
 - создать копию
 - редактировать

---

# 3.6. Alerts & Events

## Alerts
- текущие аварии:
 - зона
 - причина
 - время
 - кнопка “устранено”

## Events (история)
- все события системы
- фильтры: зона, устройство, тип, время

---

# 4. Реалтайм

## REST:
- первичная загрузка UI
- история графиков
- устройства, каналы
- рецепты/фазы

## WebSocket:
- telemetry (поток обновлений)
- zone updates
- node status updates
- alerts/events

---

# 5. Хранилище состояния (Frontend Store)

```
rootStore
 ├─ greenhousesStore
 ├─ zonesStore
 ├─ devicesStore
 ├─ telemetryStore (live data)
 ├─ alertsStore
 ├─ recipesStore
 └─ uiStore (фильтры, темы, pinned zones)
```

---

# 6. Advanced UX

## Командная палитра (Ctrl+K)
Позволяет:

- открыть зону
- открыть устройство
- поставить на паузу
- запуск полива
- открыть рецепты
- переключение фазы

## Горячие клавиши:
- Shift+Z — Zones 
- Shift+D — Devices 
- Shift+R — Recipes 
- Shift+A — Alerts 

## Избранные зоны:
Закрепляются слева для быстрого доступа.

---

# 7. AI‑интеграция

## 7.1. AI Suggestions
ИИ может показывать:

- рекомендации по pH/EC
- прогноз выхода из диапазона
- анализ аномалий
- советы по фазам

## 7.2. AI Chat
Примеры запросов:

- “почему вчера pH прыгал в зоне 3?”
- “какие зоны имеют плохой EC сегодня?”
- “создай оптимизированный рецепт для салата зимой”

---

# 8. План внедрения фронта

1. Zones List 
2. Zone Detail (основные блоки) 
3. WebSocket telemetry 
4. Devices & Device Detail 
5. Recipes & редактор фаз 
6. Alerts / Events 
7. Улучшения UX 
8. Темизация (Dark/Light) 
9. AI панель 

---

# Конец файла
