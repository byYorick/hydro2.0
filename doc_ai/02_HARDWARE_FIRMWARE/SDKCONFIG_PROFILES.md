# SDKCONFIG_PROFILES.md
# Профили sdkconfig для узлов 2.0
# Debug • Release • Общие требования

Документ описывает обязательные настройки `sdkconfig`
для прошивок узлов 2.0 и различия между профилями `debug` и `release`.


Compatible-With: Protocol 2.0, Backend >=3.0, Python >=3.0, Database >=3.0, Frontend >=3.0.
Breaking-change: legacy форматы/алиасы удалены, обратная совместимость не поддерживается.

---

## 1. Общие принципы

1. Для каждого проекта должны быть минимум два профиля:
 - `sdkconfig.debug`
 - `sdkconfig.release`
2. Активный профиль выбирается через:
 - `idf.py -D SDKCONFIG=sdkconfig.debug build`
 - `idf.py -D SDKCONFIG=sdkconfig.release build`
3. Все изменения в `sdkconfig` должны быть:
 - зафиксированы в git;
 - документированы здесь, если это не «обычный» параметр.

---

## 2. Базовые обязательные опции

(Названия опций могут слегка отличаться в зависимости от версии ESP-IDF.)

Обязательный минимум:

- Включён Wi-Fi STA:
 - `CONFIG_ESP_WIFI_ENABLED=y`
 - `CONFIG_ESP_WIFI_STA_ENABLED=y`
- Включён NVS:
 - `CONFIG_NVS_FLASH=y`
- Включён MQTT-клиент:
 - `CONFIG_MQTT_PROTOCOL_311=y`
- Включён логгер:
 - `CONFIG_LOG_DEFAULT_LEVEL=INFO` (или выше/ниже по профилю).

Рекомендуется:

- включить режим оптимизации по размеру или скорости в зависимости от профиля;
- включить `CONFIG_FREERTOS_USE_TRACE_FACILITY` в debug-профиле
 для анализа задач и стеков.

---

## 3. Отличия debug / release

### 3.1. Debug (`sdkconfig.debug`)

- Логгирование:
 - `CONFIG_LOG_DEFAULT_LEVEL_DEBUG=y`
- Ассерты:
 - включены расширенные проверки FreeRTOS (assert’ы для heap, stack overflow);
- OTA:
 - может использоваться тестовый URL/сервер;
- Watchdog:
 - включён, но таймауты могут быть чуть более мягкими для отладки.

Цель: максимальная наблюдаемость — не экономим флеш/лог.

---

### 3.2. Release (`sdkconfig.release`)

- Логгирование:
 - `CONFIG_LOG_DEFAULT_LEVEL_INFO` или `WARN`;
- Ассерты:
 - критичные assert’ы включены, но подробный трейс может быть отключён;
- Оптимизация:
 - включена оптимизация по размеру или скорости (`-Os` или `-O2`);
- OTA:
 - боевой URL/сервер;
- Ужесточённые таймауты watchdog:
 - узел обязан перезапускаться при зависании.

Цель: стабильная и предсказуемая работа в поле.

---

## 4. Специфические опции для UI / I²C / MQTT

Примеры (на уровне принципов):

- I²C:
 - `CONFIG_I2C_MS_MODE=y`
 - минимум 100 kHz, максимум 400 kHz (по железу);
- MQTT:
 - включить авто-реконнект, таймауты и максимальные размеры пакетов
 исходя из частоты телеметрии;
- UI:
 - если используется драйвер дисплея через SPI — убедиться,
 что включён нужный хост и пины не конфликтуют.

---

## 5. Требования к ИИ-агенту

1. ИИ не должен напрямую генерировать `sdkconfig` файлы.
2. При добавлении нового функционала, требующего опций:
 - агент обязан перечислить нужные опции и их значения в комментариях/доке,
 - но не менять их «вслепую».
3. Любые изменения, влияющие на память/flash (размер OTA-разделов, layout)
 должны быть отражены в отдельном документе разметки флеша (если такой есть).
