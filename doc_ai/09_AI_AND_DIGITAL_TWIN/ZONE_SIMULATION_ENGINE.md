# ZONE_SIMULATION_ENGINE.md
# Движок симуляции зон (Zone Simulation Engine) 2.0

Документ описывает модуль симуляции зон, основанный на Digital Twin.

---

## 1. Назначение

Zone Simulation Engine (ZSE) позволяет:

- прогонять рецепты и сценарии на цифровом двойнике зоны;
- оценивать, как изменятся pH/EC/климат при заданных действиях;
- тестировать новые алгоритмы дозирования и полива;
- обучать AI-модели на синтетических данных.

---

## 2. Основные сценарии использования

1. **Тестирование новых рецептов** до применения на реальной зоне.
2. **Анализ чувствительности** — как изменится результат при изменении параметров оборудования.
3. **Отладка контроллеров** — проверка логики pH/EC-контроллеров без железа.

---

## 3. Интерфейс модуля

Пример REST-интерфейса (может быть gRPC):

### POST /simulate/zone

Тело запроса:

```json
{
 "zone_id": 1,
 "duration_hours": 72,
 "step_minutes": 10,
 "scenario": {
 "recipe_id": 3,
 "initial_state": {
 "ph": 6.0,
 "ec": 1.2,
 "temp_air": 22,
 "temp_water": 20
 }
 }
}
```

Ответ:

```json
{
 "status": "ok",
 "data": {
 "points": [
 {
 "t": 0,
 "ph": 6.0,
 "ec": 1.2,
 "temp_air": 22,
 "temp_water": 20
 }
 ]
 }
}
```

---

## 4. Интеграция с Digital Twin

- ZSE использует модели из `DIGITAL_TWIN_ENGINE.md`.
- Для каждой зоны может быть свой набор параметров модели.
- При выполнении симуляции ZSE:

 1. загружает конфигурацию модели зоны;
 2. применяет сценарий (рецепт, графики полива/света);
 3. прогоняет шаги симуляции;
 4. возвращает временные ряды параметров.

---

## 5. Логирование и хранение результатов

- Результаты крупных симуляций могут сохраняться в БД или в объектное хранилище
 (для последующего анализа или визуализации в Grafana/Jupyter).
- Важно хранить:
 - идентификатор сценария;
 - версию моделей;
 - входные параметры;
 - агрегированные метрики результата.

---

## 6. Правила для ИИ-агентов

1. Не смешивать коды боевого контура и симуляции.
2. Не менять базовый формат `/simulate/zone` без синхронизации с Backend.
3. Новые типы сценариев/метрик документировать здесь и в `AI_IMPLEMENTATION_ROADMAP.md`.
