# AI_OPTIMIZATION_ENGINE.md
# Архитектура AI-движка оптимизации 2.0

Документ описывает модуль AI-оптимизации, который работает поверх Digital Twin и
телеметрии, помогая улучшать урожайность и экономить ресурсы.

---

## 1. Назначение

AI-движок выполняет:

- прогнозирование поведения параметров (pH, EC, температура, влажность);
- рекомендацию корректировок рецептов (targets, длительность фаз);
- оптимизацию поливов и дозировок;
- оценку риска (кислотность, засоление, перегрев и т.п.);
- анализ эффективности оборудования и энергопотребления.

AI **не отправляет команды напрямую узлам** — он отдаёт рекомендации Python-сервису/Backend.

---

## 2. Входные данные

- Историческая телеметрия (`telemetry_samples`).
- Текущие состояния зон, рецептов и фаз.
- Метаданные культур (вид/сорт, целевые диапазоны).
- События и алерты (поломки, отклонения, ручные вмешательства).
- Параметры оборудования (мощность насосов, светильников и т.п.).

---

## 3. Выходные артефакты

1. **Рекомендации по рецептам**:
 - изменение target pH/EC;
 - изменение длительности фаз;
 - расписание света/поливов.
2. **Предупреждения**:
 - «слишком частые дозировки pH-корректоров»;
 - «высокий риск закисления раствора»;
 - «перегрев зоны в дневные часы».
3. **Сценарии для симуляции** (для `ZONE_SIMULATION_ENGINE.md`).

Результаты сохраняются в БД (например, таблица `ai_suggestions`) и доступны через API.

---

## 4. Архитектура AI-модуля

AI-движок может быть реализован как отдельный сервис (Python), который:

- читает данные из БД (через read-only пользователя);
- периодически запускает анализ (cron/job);
- пишет результаты обратно в БД;
- предоставляет REST/gRPC-интерфейс для on-demand запросов.

Слои внутри сервиса:

1. **Data Layer** — загрузка данных из БД.
2. **Feature Layer** — подготовка признаков (rolling-окна, агрегаты).
3. **Model Layer** — ML-модели (Time Series, Regression, классификация).
4. **Policy Layer** — доменные правила и фильтры безопасности (не выходить за допустимые диапазоны).
5. **API Layer** — интерфейс к Backend/UI.

---

## 5. Безопасность и ограничения

- AI не может изменять конфигурацию зон напрямую.
- Любая рекомендация должна проходить через подтверждение оператора
 или через контролируемый режим «auto-apply» с жёсткими лимитами.
- Никаких «чёрных ящиков», влияющих на безопасность растений без логов.
- Каждый совет должен быть трассируем:
 - какие данные использованы;
 - каким алгоритмом;
 - какие ограничения применены.

---

## 6. Правила для ИИ-агентов

1. При модификации AI-движка нельзя ломать существующие интерфейсы с Backend.
2. Новые типы рекомендаций должны быть описаны:
 - в этом документе;
 - в `DATABASE_SCHEMA_AI_GUIDE.md` (какие таблицы/поля добавляются).
3. Алгоритмы должны быть устойчивы к отсутствующим данным/выбросам.

AI-движок здесь — **интеллектуальный помощник**, но не «автопилот без ограничений».
