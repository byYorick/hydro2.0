# DIGITAL_TWIN_ENGINE.md
# Архитектура Digital Twin для зоны/теплицы 2.0

Digital Twin (цифровой двойник) — это математическая/программная модель зоны,
которая позволяет прогнозировать реакцию системы на различные воздействия.


Compatible-With: Protocol 2.0, Backend >=3.0, Python >=3.0, Database >=3.0, Frontend >=3.0.
Breaking-change: legacy форматы/алиасы удалены, обратная совместимость не поддерживается.

---

## 1. Цели Digital Twin

- Смоделировать динамику pH/EC при дозировании, испарении и замене раствора.
- Смоделировать климат (температура, влажность) при различных сценариях вентиляции/обогрева.
- Тестировать рецепты и расписания **без риска для живых растений**.
- Использовать результаты симуляции в AI-оптимизации.

---

## 2. Входные данные

- Конфигурация зоны (объём резервуаров, мощность насосов, тип субстрата).
- Текущие цели/рецепты.
- Исторические данные о реакции системы (как менялись pH/EC после дозировок).
- Параметры оборудования (скорости насосов, расход воды).

---

## 3. Модель зоны

В простейшем варианте:

- Модель pH:
 - текущий pH;
 - буферная ёмкость раствора;
 - влияние дозировки кислоты/щёлочи;
 - естественное смещение pH во времени.
- Модель EC:
 - текущая концентрация солей;
 - дозировка питательного раствора;
 - испарение/долив чистой воды.
- Модель климата:
 - баланс тепла и влаги;
 - влияние вентиляторов и притока воздуха;
 - внешняя температура/влажность.

Все модели могут быть гибридными: физические законы + эмпирические коэффициенты, обученные на данных.

---

## 4. Архитектура модуля Digital Twin

- Сервис (Python) с API:
 - `/simulate/zone` — запустить симуляцию сценария;
 - `/calibrate/zone` — калибровка параметров модели по историческим данным.
- Хранение конфигурации моделей — в БД (например, таблицы `zone_models`, `zone_model_params`).

---

## 5. Связь с AI и Scheduler

- AI-движок использует Digital Twin для тестирования своих рекомендаций.
- Scheduler может запускать «ночные» симуляции для оценки рисков.
- Результаты симуляций сохраняются в отдельные таблицы/лог-файлы для анализа.

---

## 6. Правила для ИИ-агентов

1. Не смешивать код Digital Twin с боевой логикой контроллеров.
2. Все изменения модели должны быть конфигурируемыми (параметры в БД, а не «магические числа» в коде).
3. Не использовать Digital Twin для прямого управления оборудованием.
