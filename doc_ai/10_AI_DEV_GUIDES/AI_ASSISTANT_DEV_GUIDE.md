# AI_ASSISTANT_DEV_GUIDE.md
# Руководство для ИИ‑агентов по работе со всей системой 2.0
# Laravel + Python + MQTT + PostgreSQL + ESP32

Этот документ определяет, **как ИИ‑агент должен вести себя** при работе 
над проектом гидропонной теплицы 2.0. 
Он задаёт строгие стандарты, чтобы ИИ‑агент мог:
- дополнять систему, 
- улучшать её, 
- создавать новый код, 
**но не нарушать совместимость**, целостность и архитектуру.

---

# 1. Роль ИИ в проекте

ИИ является:
- **архитектором** (может предлагать улучшения), 
- **разработчиком** (может писать код Laravel/Python/Vue), 
- **аналитиком** (может оптимизировать схемы, контроллеры, MQTT), 
- **генератором документации**.

ИИ НЕ является:
- человеком‑оператором, 
- ESP‑прошивкой, 
- автономным источником данных.

ИИ работает ТОЛЬКО в рамках:
- Laravel backend + Inertia,
- Python MQTT Service,
- PostgreSQL,
- MQTT-брокера,
- ESP32‑узлов с фиксированным протоколом.

---

# 2. Основные правила поведения ИИ‑агента

## 2.1. Нельзя ломать существующую архитектуру

Запрещено:
- менять форматы MQTT‑топиков,
- менять структуру payload,
- менять схемы БД с обратной несовместимостью,
- переименовывать ключевые поля,
- удалять существующие таблицы или модели.

Разрешено:
- расширять архитектуру,
- добавлять новые message_type,
- добавлять новые таблицы,
- улучшать алгоритмы.

---

## 2.2. ИИ должен понимать ВЕСЬ pipeline системы

Pipeline:

1. Узел ESP32 → публикует MQTT telemetry/status 
2. Python‑сервис → принимает, валидирует, пишет в БД 
3. PostgreSQL → хранит telem_last + историю 
4. Laravel → отдаёт данные Inertia‑фронтенду 
5. Vue 3 → отображает UI 
6. Laravel/Python отправляет команды узлам через MQTT

У любого изменения должны быть учтены ВСЕ 6 уровней.

---

## 2.3. ИИ обязан учитывать зоны ответственности

| Компонент | Что можно менять | Что нельзя |
|------------------------|------------------|------------|
| **Laravel** | Добавлять маршруты, модели, страницы | Менять Inertia формат без обновления Vue |
| **Vue 3** | Добавлять UI, улучшать UX | Ломать структуру props |
| **Python‑service** | Алгоритмы контроллеров, обработку MQTT | Менять command format |
| **PostgreSQL** | Добавлять таблицы, поля | Удалять/переименовывать обязательные |
| **MQTT** | Добавлять новые message_type | Менять существующие |
| **ESP32 протокол** | Добавлять опциональные функции | Ломать совместимость |

---

# 3. Стандартный рабочий процесс ИИ

Каждое изменение состоит из:

### 1. Анализ 
- Какие таблицы задействованы? 
- Какие контроллеры участвуют? 
- Какие UI‑элементы должны обновиться?

### 2. Планирование 
ИИ составляет план, например:
- добавляем новый тип сенсора,
- расширяем протокол,
- создаём UI для нового устройства.

### 3. Генерация кода 
ИИ генерирует:
- миграции Laravel,
- модели, контроллеры,
- Python‑классы обработчиков,
- MQTT‑маршруты,
- Vue‑компоненты.

### 4. Проверка совместимости 
ИИ обязан убедиться, что:
- список topic’ов не нарушен,
- schema БД расширена корректно,
- Laravel получает корректные инерция‑props,
- Python корректно обрабатывает новые данные.

---

# 4. Зоны автономии ИИ

ИИ может самостоятельно:

## 4.1. Добавлять новые сенсоры
Пример:
- temp_leaf,
- co2_ppm,
- uv_intensity.

## 4.2. Добавлять новые актуаторы
Например:
- dosing_micro_pump,
- ph_stabilizer_pwm.

## 4.3. Добавлять новые контроллеры
Например:
- advanced_light_controller,
- vpd_controller (vapor pressure deficit).

## 4.4. Вводить новые UI‑страницы
Например:
- Глубокая аналитика графиков,
- Журнал обслуживания,
- Сравнение зон.

## 4.5. Разрабатывать умные функции
Например:
- автокалибровка pH/EC,
- прогнозирование урожайности,
- авто‑оптимизация рецептов.

---

# 5. Ограничения ИИ

ИИ НЕ ДОЛЖЕН:

1. Предлагать изменения без учёта всей архитектуры 
2. Менять имена таблиц/моделей 
3. Менять ID зон/узлов/каналов 
4. Генерировать код, не совместимый с Laravel Inertia 
5. Разрывать связь Python ↔ MQTT 
6. Генерировать команды, не соответствующие спецификации 
7. Обходить scheduler или создавать команды напрямую в MQTT (мимо Python)

---

# 6. Архитектура для ИИ: уровни и зависимости

```
ESP32 → MQTT → Python → PostgreSQL → Laravel → Vue → User
```

ИИ должен следить за:

### 6.1. ESP32 → MQTT
- telemetry форма строго `{value, ts}`
- status → каждые 60 сек
- команды → только через Python

### 6.2. Python → PostgreSQL
Любая новая метрика должна иметь:
- запись в telemetry_samples,
- запись/обновление в telemetry_last.

### 6.3. Laravel → Vue
Любые изменения в Laravel props требуют обновления Vue.

### 6.4. Vue → User
UI должен оставаться понятным.

---

# 7. Расширения, которые ИИ может делать безопасно

### 7.1. Новый модуль: VPD (дефицит давления пара)
Цели:
- точный климат‑контроль

### 7.2. Новый контроллер света с PWM
Цели:
- плавная рассвет/закат симуляция

### 7.3. Модуль прогнозирования
Цели:
- прогноз EC/pH,
- аномалии.

### 7.4. Аналитика воды
- расход,
- минерализация,
- баланс питательных веществ.

---

# 8. Логика версии (Versioning)

ИИ обязан указывать совместимость:

```
Compatible-With:
 Protocol: 2.0
 Backend: >=3.0
 Python: >=3.0
 Database: >=3.0
 Frontend: >=3.0
```

Если изменения несовместимы:
- они должны быть вынесены в 2.0 spec.

---

# 9. Чек-лист ИИ перед выпуском изменений

1. Изменение не ломает MQTT протокол? 
2. Telemetry сохраняется полностью? 
3. Проверены все уровни pipeline? 
4. Python обработает все новые данные? 
5. Laravel получит понятные props? 
6. Vue корректно их покажет? 
7. Схема БД согласована с Laravel и Python? 
8. Команды узлам формируются по 2.0? 
9. Никаких backward‑breaking изменений? 

---

# Конец файла AI_ASSISTANT_DEV_GUIDE.md
