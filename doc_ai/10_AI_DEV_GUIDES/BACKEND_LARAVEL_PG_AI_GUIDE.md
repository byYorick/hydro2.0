# BACKEND_LARAVEL_PG_AI_GUIDE.md
# Инструкция для ИИ-агентов по backend (Laravel + PostgreSQL)

Этот документ объясняет ИИ-агентам, как безопасно работать с backend-частью проекта.


Compatible-With: Protocol 2.0, Backend >=3.0, Python >=3.0, Database >=3.0, Frontend >=3.0.
Breaking-change: legacy форматы/алиасы удалены, обратная совместимость не поддерживается.

---

## 1. Основные принципы

1. **Laravel — владелец схемы БД.**
 - Все изменения таблиц через миграции.
2. **Доменные сущности должны быть согласованы с `../05_DATA_AND_STORAGE/DATA_MODEL_REFERENCE.md`.**
3. **Никаких прямых обращений к MQTT из Laravel.**
 - Взаимодействие с узлами — только через Python-сервис.
4. **Не вмешиваться в базовые механизмы auth/roles без необходимости.**

---

## 2. Что разрешено делать ИИ-агентам

- Добавлять новые эндпоинты в `routes/api.php` и `Controllers`, **если** они документированы.
- Добавлять Service-классы для бизнес-логики.
- Расширять модели (`app/Models/*`) новыми связями и аксессорами.
- Добавлять миграции для новых таблиц/полей.

---

## 3. Чего нельзя делать

- Удалять существующие поля/таблицы без миграций и согласования.
- Менять типы полей телеметрии и событий без серьёзной причины.
- Встраивать тяжёлую логику (ML, симуляции) прямо в Laravel-код — это должно жить в отдельных сервисах.

---

## 4. Схема БД (связь с другими документами)

При изменениях:

- сначала обновить `../05_DATA_AND_STORAGE/DATA_MODEL_REFERENCE.md` (описать новые сущности/поля);
- затем создать миграции и модели;
- при необходимости обновить `DATABASE_SCHEMA_AI_GUIDE.md`.

---

## 5. Связь с Python и AI

- Все вызовы Python-сервиса должны быть централизованы в одном/нескольких сервисах Laravel,
 а не размазаны по контроллерам.
- AI-интеграция (предложения рецептов, диагностика) должна происходить через чётко описанные API.

---

## 6. Резюме

ИИ-агенты могут уверенно расширять backend, если:

- соблюдают архитектурные слои;
- не ломают существующую схему БД;
- документируют новые публичные API;
- не делают Laravel «монолитом, который делает всё».
