# Гайд по написанию промптов для hydro2.0


Compatible-With: Protocol 2.0, Backend >=3.0, Python >=3.0, Database >=3.0, Frontend >=3.0.
Breaking-change: legacy форматы/алиасы удалены, обратная совместимость не поддерживается.

Практический чек-лист, чтобы быстро формулировать запросы к ИИ для задач проекта hydro2.0.

## Что уточнить перед формированием промпта
- Начните с корневого `../../AGENTS.md`, затем проверьте релевантные AGENTS.md и конвенции в каталоге задачи, зафиксируйте версии фреймворков и зависимостей.
- Убедитесь, что понятен требуемый результат (файл, экран, сервис, тесты) и среда запуска (локально/CI, доступные токены).
- Соберите ограничения: запрещённые файлы/директории, запрет на новые зависимости/миграции, требования к откату.
- Выясните, какие проверки обязательны: unit/integration/e2e, статический анализ, симуляторы/эмуляторы, ручные сценарии.
- Подготовьте ссылки на исходные файлы, схемы БД/протоколов, тикет или обсуждение, чтобы исключить домыслы.

## Что обязательно указать в промпте
- **Цель и готовый результат.** Опишите, что должно получиться (файл/файлы, API-метод, экран, скрипт), и критерии приемки.
- **Подсистема и контекст.** Уточните область: backend (Laravel 12, PHP 8.2), Android (Kotlin, Clean Architecture), MQTT/транспорт, прошивки, инфраструктура. Добавьте ссылки на файлы/директории, схемы, существующие конвенции.
- **Ограничения и запреты.** Например: не менять миграции, не трогать прод-конфиг, не добавлять зависимости, работать только в указанном модуле.
- **Инструменты и проверки.** Какие команды/тесты запустить (phpunit, линтеры, симуляторы), какие данные/токены доступны, что считать успешным запуском.
- **Формат ответа.** Запросите структуру (Summary/Changes/Tests), схемы JSON, списки файлов и шаги применения.
- **Риски и пропуски.** Попросите отметить недостающие данные (URL, секреты, схемы БД) вместо их выдумывания.

## Быстрые чек-листы по типам задач
- **Backend (Laravel 12, PHP 8.2):** указывайте контроллер/сервис/модель, версию Laravel и пакеты; требуйте PHPUnit-тесты и Pint; проговаривайте работу с миграциями/сидерами, сид-данными и rollback.
- **Android (Kotlin, Clean Architecture):** фиксируйте слой (data/domain/presentation), интеграции (repository/use-case/viewmodel), DI через Koin, Retrofit, Reverb WebSocket; просите unit/instrumentation-тесты для критичных сценариев и ожидания по потокам/корутинам.
- **MQTT/транспорт и интеграции:** перечисляйте топики, полезную нагрузку, QoS, идемпотентность; уточняйте сериализацию, ретраи/тайм-ауты и требования к офлайн/повторной доставке.
- **Инфраструктура и CI/CD:** уточняйте целевые окружения, переменные и секреты, ограничения по Terraform/Ansible/Helm, команды для проверки пайплайна; требуйте обратный план отката.
- **Прошивки и устройства:** фиксируйте плату/контроллер, ограничения памяти/питания, протокол обмена (UART/CAN/MQTT), шаги для прошивки и тесты на стенде/эмуляторе.
- **Документация и спецификации:** задайте целевой раздел, формат (списки, таблицы, диаграммы), язык (RU/EN) и укажите, что правки вносятся в `doc_ai/` (зеркало `docs/` обновляется автоматически).

## Базовый шаблон промпта
Используйте и дополняйте под конкретную задачу:

```
Ты — GPT-5.1 Codex Max, помогаешь с hydro2.0.
Цель: <что нужно сделать>.
Область: <backend/android/mqtt/infra/firmware>.
Контекст: <файлы и каталоги, текущая реализация, зависимости, env/порты>.
Ограничения: <что нельзя менять, требования к безопасности/производительности/UX>.
Тесты и проверки: <какие тесты добавить/запустить, что проверить вручную>.
Формат ответа: <Summary/Changes/Tests, списки файлов, схемы или команды>.
Риски и пропуски: <что нужно уточнить перед выполнением>.
```

## Пошаговый алгоритм
1) Кратко опиши цель, область и запреты (без деталей реализации).
2) Приложи ссылки на исходники/схемы и выпиши обязательные проверки/тесты.
3) Запроси у ассистента план с перечнем файлов и рисков перед генерацией кода.
4) После получения плана — уточни пробелы (среда, токены, порты, миграции, конфиг).
5) Попроси финальную самопроверку по критериям приёмки и форматам вывода.

## Мини-примеры
- **Backend:** «Добавь API для экспорта зон в CSV, без изменений БД; контроллер ZoneExportController, сервис уже есть; добавь PHPUnit-тесты для валидных и пустых данных; опиши команды для запуска тестов».
- **Android:** «В слое presentation добавь экран истории событий с пагинацией; данные берём из `EventRepository`; Retrofit уже настроен; покажи, как обновить Koin-модуль и написать unit-тест ViewModel».

## Как составить промпт для поиска багов и ошибок
1. **Определи симптомы.** Опиши, что именно ломается: сообщение об ошибке, неверный ответ API, лаги, падение приложения, дубли в MQTT, некорректные графики в UI.
2. **Зафиксируй окружение.** Укажи ветку/коммит, конфиги, флаги, переменные окружения, используемые токены/данные, устройство (модель/ОС/прошивка) и сеть (Wi‑Fi/сотовая, VPN).
3. **Дай воспроизведение.** Пошаговый сценарий с входными данными/топиками/пакетами, какие сервисы или эмуляторы должны быть запущены, какие порты используются.
4. **Приложи наблюдения.** Логи (фрагменты с таймштампами), метрики/трейсы (CPU/RAM/latency), скриншоты/видео, SQL-запросы, дампы payload-ов, сравнение ожидаемого и фактического поведения.
5. **Сузь область.** Назови подсистему (backend/Android/MQTT/infra/firmware), ключевые файлы/модули/контроллеры/таски CI, связанные тикеты или недавние релизы.
6. **Ограничения и риски.** Что нельзя трогать (прод-конфиг, миграции, токены), лимиты по времени/нагрузке, чувствительные данные, запрет на новые зависимости.
7. **Запроси выходной формат.** Попроси план расследования, гипотезы, проверки, список затронутых файлов и команды для воспроизведения/логов/тестов, а также самопроверку без генерации лишнего кода.

### Быстрый шаблон для поиска багов
```
Нужно найти и локализовать баг.
Симптом: <ошибка/неверный ответ/падение/лаг>.
Окружение: <ветка, коммит, конфиг, устройство/ОС/прошивка, сеть>.
Воспроизведение: <пошаговый сценарий, входные данные/топики, что должно быть запущено>.
Наблюдения: <логи с таймштампами, метрики, скриншоты/видео, ожидаемое vs фактическое>.
Область: <backend/android/mqtt/infra/firmware>, ключевые файлы/модули <...>.
Ограничения: <что нельзя менять, лимиты, секреты>.
Запрос результата: план расследования, гипотезы и проверки, команды для воспроизведения/логов/тестов, список файлов, формат Summary/Changes/Tests.
```

## Памятка
- Ссылайтесь на существующие файлы и соглашения, а не изобретайте новые.
- Требуйте пошаговый план и список затронутых файлов перед генерацией кода.
- Просите финальную самопроверку по критериям приемки и форматам вывода.
