# AI_TASK_TEMPLATES_AND_PATTERNS.md
# Шаблоны задач для ИИ-агентов
# Как правильно ставить задачи • Примеры

Документ предназначен для людей и meta-агентов,
которые ставят задачи другим ИИ-агентам для разработки Hydro 2.0.


Compatible-With: Protocol 2.0, Backend >=3.0, Python >=3.0, Database >=3.0, Frontend >=3.0.
Breaking-change: legacy форматы/алиасы удалены, обратная совместимость не поддерживается.

---

## 1. Общие принципы постановки задач

Хорошая задача для ИИ должна:

1. Чётко указывать **контекст**:
 - над каким репозиторием/папкой работаем,
 - какие файлы считаются каноничными,
 - какие документы описывают архитектуру.
2. Описывать **цель**:
 - что должно измениться с точки зрения поведения системы.
3. Содержать **ограничения**:
 - какие файлы нельзя трогать,
 - какие протоколы/контракты менять запрещено,
 - какие стандарты надо соблюдать (ESP32_C_CODING_STANDARDS, и т.п.).
4. Описывать **формат результата**:
 - изменённые файлы,
 - новые файлы,
 - короткий changelog.

---

## 2. Шаблон: задача на изменение/добавление прошивки узла

**Название:** 
«Добавить поддержку нового сенсора/функции в прошивку узла»

**Шаблон задачи:**

> Контекст:
> - Узел: [тип ноды, например PH_NODE].
> - Репозиторий: [ссылка/путь].
> - Архитектура прошивки описана в:
> - `../SYSTEM_ARCH_FULL.md`
> - `../02_HARDWARE_FIRMWARE/HARDWARE_ARCH_FULL.md`
> - `../02_HARDWARE_FIRMWARE/ESP32_C_CODING_STANDARDS.md`
> - UI описан в:
> - `../02_HARDWARE_FIRMWARE/NODE_OLED_UI_SPEC.md`
> - `../02_HARDWARE_FIRMWARE/NODE_INPUT_CONTROLS.md`
>
> Цель:
> - Реализовать [описание функции, например: «поддержку калибровки по трём точкам»].
>
> Ограничения:
> - Соблюдать ESP-IDF и C-only.
> - Не изменять MQTT-контракт без крайней необходимости.
> - Любое изменение MQTT-топиков необходимо описать в `../03_TRANSPORT_MQTT/MQTT_SPEC_FULL.md` и `../03_TRANSPORT_MQTT/BACKEND_NODE_CONTRACT_FULL.md`.
>
> Что сделать:
> 1. Описать изменения на уровне модулей (какие новые .c/.h файлы, какие изменения в существующих).
> 2. Сгенерировать код модулей/изменений.
> 3. Обновить документацию, если что-то поменялось.
>
> Формат результата:
> - Список изменённых/новых файлов.
> - Патчи (diff) или полный текст файлов.
> - Краткое описание логики.

---

## 3. Шаблон: задача на изменение backend/БД

**Название:** 
«Расширить модель данных и API для …»

**Шаблон задачи:**

> Контекст:
> - Backend: [Laravel/др. стек, указать].
> - Текущие модели описаны в:
> - `../05_DATA_AND_STORAGE/DATA_MODEL_REFERENCE.md`
> - `../04_BACKEND_CORE/BACKEND_ARCH_FULL.md`
> - `DATABASE_SCHEMA_AI_GUIDE.md`
>
> Цель:
> - Добавить/изменить [новую сущность/поле/связь], чтобы поддержать [новую функцию].
>
> Ограничения:
> - Поддерживать обратную совместимость API, если возможно.
> - Любые breaking changes должны быть явно выделены.
>
> Что сделать:
> 1. Описать изменения в моделях (ER-диаграмма, связи).
> 2. Обновить миграции БД.
> 3. Обновить модели и слои домена.
> 4. Обновить API-эндпоинты, если требуется.
> 5. Обновить документацию и AI-гайды по схемам.
>
> Формат результата:
> - Новые/изменённые файлы миграций.
> - Изменённые модели.
> - Обновлённая документация.
> - Короткий changelog.

---

## 4. Шаблон: задача на изменение MQTT-спеки

**Название:** 
«Обновить MQTT-спеку для …»

> Контекст:
> - Протокол описан в:
> - `../03_TRANSPORT_MQTT/MQTT_SPEC_FULL.md`
> - `../03_TRANSPORT_MQTT/BACKEND_NODE_CONTRACT_FULL.md`
>
> Цель:
> - Внести изменения в MQTT-протокол, чтобы поддержать [новую возможность].
>
> Ограничения:
> - По возможности сохранять совместимость с существующими узлами.
> - Изменения должны быть атомарными и чётко документированы.
>
> Что сделать:
> 1. Описать новые/изменённые топики.
> 2. Описать payload (JSON-схемы).
> 3. Указать примеры сообщений.
> 4. Описать миграцию (как жить старым узлам/клиентам).
>
> Формат результата:
> - Обновлённые файлы спек.
> - Краткое резюме изменений.

---

## 5. Шаблон: рефакторинг / улучшение архитектуры

**Название:** 
«Рефакторинг [модуля/сервиса] без изменения внешнего поведения»

> Контекст:
> - Модуль: [например, `wifi_engine` в прошивке].
> - Связанная документация:
> - `../02_HARDWARE_FIRMWARE/ESP32_C_CODING_STANDARDS.md`
> - `../02_HARDWARE_FIRMWARE/WIFI_CONNECTIVITY_ENGINE.md`
>
> Цель:
> - Улучшить читаемость, распределение ответственности, тестируемость.
>
> Ограничения:
> - Внешнее поведение не должно измениться.
> - Не менять публичные API без крайней необходимости.
>
> Что сделать:
> 1. Выделить подмодули, если необходимо.
> 2. Убрать дублирование.
> 3. Добавить комментарии/докстроки, если их не хватает.
>
> Формат результата:
> - Список изменений.
> - Обоснование, почему поведение не должно измениться.

---

## 6. Требования к meta-агенту

1. При генерации задач другим ИИ всегда ссылаться на **конкретные файлы/доки**.
2. Не выдавать ИИ задачу, которую невозможно выполнить без уточняющей информации.
3. Обеспечивать консистентность:
 - если одна задача меняет MQTT-протокол, другая, зависящая от него, должна это учитывать.
