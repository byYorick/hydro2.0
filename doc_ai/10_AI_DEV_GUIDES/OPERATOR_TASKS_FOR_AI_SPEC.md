# OPERATOR_TASKS_FOR_AI_SPEC.md
# Спецификация: как оператору давать задания для ИИ в системе Hydro 2.0

Этот документ объясняет, **как оператор теплицы** (не программист) должен формулировать задачи
для ИИ‑агентов системы Hydro 2.0: голосом, текстом или через интерфейс.
Цель — чтобы ИИ выполнял нужные действия **понятно, безопасно и прогнозируемо**.

Документ дополняет:
- `../TASKS_FOR_AI_AGENTS.md` — технический гайд для разработчиков и ИИ‑агентов.
- `../SYSTEM_ARCH_FULL.md` — общая архитектура системы 2.0.
- `06_DOMAIN_ZONES_RECIPES/*` — доменная логика, зоны и рецепты.

Здесь всё написано простым языком, ориентированным на оператора.


Compatible-With: Protocol 2.0, Backend >=3.0, Python >=3.0, Database >=3.0, Frontend >=3.0.
Breaking-change: legacy форматы/алиасы удалены, обратная совместимость не поддерживается.

---

## 1. Общая идея

В Hydro 2.0 ИИ используется как **умный помощник оператора**, а не как “чёрный ящик”.
Оператор говорит, что нужно сделать, ИИ:
- понимает задачу;
- проверяет ограничения и безопасность;
- предлагает план или сам выполняет действие (в рамках разрешённого).

Чтобы всё работало правильно, важно, чтобы каждая задача ИИ содержала:

1. **Что сделать** — действие.
2. **Где** — какая теплица, зона, ёмкость, узел.
3. **Когда** — сейчас, по расписанию, один раз или регулярно.
4. **Как сильно** — доза, время, целевой параметр (pH, EC, время полива и т.п.).
5. **Ограничения** — чего делать нельзя (например, не превышать pH, не менять рецепт).

---

## 2. Типы задач, которые оператор может давать ИИ

### 2.1. Оперативные задачи (прямые действия)

Примеры:
- “Сделай корректировку pH в зоне 1 до 5.9”
- “Полей зону 2 на 5 минут”
- “Включи подсветку в зоне 3 на 2 часа”
- “Отключи все насосы в зоне 1, кажется, там утечка”

Что важно добавлять:
- номер зоны / имя зоны;
- канал или функция (pH, EC, полив, свет);
- целевое значение или время.

### 2.2. Диагностика и проверка

Примеры:
- “Проверь, всё ли нормально с насосами в зоне 1”
- “Есть ли сейчас ошибки по датчикам pH?”
- “Покажи последние 24 часа pH и EC в зоне 2”
- “Почему pH в зоне 1 ушёл выше 6.5?”

Здесь ИИ должен:
- собрать данные (telemetry, алерты);
- показать оператору краткий вывод;
- предложить варианты действий.

### 2.3. Работа с рецептами и режимами

Примеры:
- “Поменяй рецепт салата в зоне 1 на ‘Salad_Mix_Standard’”
- “Сделай мягкий режим для рассады в зоне 3”
- “Понизь целевой EC для зоны 2 на 0.2”

Для таких задач ИИ **обязан**:
- показать, какой рецепт был;
- показать, на что меняем;
- спросить подтверждение, если изменение рискованное (например, сильное изменение pH/EC).

### 2.4. Планирование и расписания

Примеры:
- “Сделай полив в зоне 2 каждый день в 7:00 и 19:00”
- “Сделай режим ночного света в зоне 1 с 22:00 до 5:00”

ИИ:
- формирует/обновляет расписание;
- показывает оператору итоговую таблицу расписаний;
- спрашивает подтверждение перед сохранением.

### 2.5. Сервис и обслуживание

Примеры:
- “Напомни через 2 недели промыть систему в зоне 1”
- “Добавь задачу — калибровка pH‑датчиков в этой теплице раз в месяц”
- “Проверь, какие датчики давно не калибровались”

---

## 3. Как правильно формулировать задачу

### 3.1. Структура “хорошей” задачи

Хорошая задача для ИИ содержит:

1. **Действие**  
   Что сделать: полить, отк скорректировать pH, изменить рецепт, посмотреть отчёт.

2. **Объект**  
   Где: теплица, зона, резервуар, культура, конкретный узел.

3. **Параметры**  
   Насколько: время, доза, целевое значение (pH, EC, время полива, мощность света).

4. **Время**  
   Когда: сейчас, с такого времени, по расписанию.

5. **Ограничения** (если есть)  
   Например:
   - “не повышай EC выше 2.0”
   - “не трогай другие зоны”
   - “только один раз”.

#### Примеры “как надо”

- “Сейчас скорректируй pH в зоне 1 до 5.9. Не меняй рецепт, только разовая коррекция.”
- “Включи полив в зоне 2 на 3 минуты прямо сейчас, и **не трогай** остальные зоны.”
- “Сделай отчёт по зоне 1 за последние 7 дней: pH, EC, полив, ошибки по насосам.”

#### Примеры “как плохо”

- “Сделай хорошо”  
  → непонятно, что именно.
- “Полей как обычно”  
  → “как обычно” не конкретно, ИИ должен знать схему.

---

## 4. Формулировки по безопасности

Есть набор действий, которые ИИ **не должен делать без явного подтверждения оператора**:

1. Сильно менять pH или EC:
   - “изменить pH более чем на 0.5 за один шаг”;
   - “поднять EC больше, чем на 0.4 за раз”.

2. Полностью включать/выключать полив для зоны на долгий срок.

3. Отключать все защитные лимиты (SAFE_MODE, пороги насосов, аварийные отключения).

Поэтому оператор должен быть готов к тому, что ИИ спросит:
- “Вы уверены?”,
- покажет расчёт последствий,
- попросит ввести подтверждение (например: “подтвердить команда: ПОДТВЕРЖДАЮ”).

Пример “опасной” задачи, которую ИИ должен перепроверить:
- “Отмени все ограничения по дозировке pH в зоне 1”
- “Сделай pH ровно 4.5 в зоне 1” (слишком кислый раствор)

---

## 5. Примеры шаблонов для оператора

### 5.1. Шаблон: разовая корректировка pH

**Фраза для оператора (голос/текст):**

> “Скорректируй pH в зоне <номер/название> до <значение>, сделай это один раз и не меняй рецепт.”

Пример:

> “Скорректируй pH в зоне 1 до 5.9, один раз, без изменения рецепта.”

Что должен сделать ИИ:
- Посмотреть текущий pH.
- Рассчитать дозу.
- Отправить команду на дозирование.
- Дождаться ответа `command_response`.
- Через некоторое время перепроверить pH и показать результат оператору.

### 5.2. Шаблон: запуск полива

**Фраза:**

> “Включи полив в зоне <номер> на <время> минут.”

Пример:
> “Включи полив в зоне 2 на 4 минуты прямо сейчас.”

ИИ:
- проверяет, нет ли запрета (авария, SAFE_MODE);
- запускает полив;
- контролирует ток насосов (по логике INA209);
- по завершении даёт отчёт оператору.

### 5.3. Шаблон: отчёт по зоне

**Фраза:**

> “Сделай отчёт по зоне <номер> за последние <N> дней, по параметрам <список>.”

Пример:
> “Сделай отчёт по зоне 1 за последние 7 дней: pH, EC, полив, ошибки по насосам.”

ИИ:
- собирает данные;
- строит краткую сводку;
- при необходимости — формирует графики/таблицы.

### 5.4. Шаблон: расписание полива

**Фраза:**

> “Сделай полив в зоне <номер> по расписанию: каждый день в <время> и <время>.”

Пример:
> “Сделай полив в зоне 2 каждый день в 7:00 и 19:00, по 3 минуты.”

ИИ:
- формирует расписание;
- показывает, как оно будет выглядеть по дням;
- спрашивает подтверждение.

---

## 6. Как оператору понять, что ИИ всё сделал правильно

Каждый раз, когда оператор даёт задачу, нужно ожидать от ИИ:

1. **Подтверждение понимания задачи**  
   Краткий пересказ:
   - “Вы просите: скорректировать pH в зоне 1 до 5.9 один раз, без изменения рецепта.”

2. **План действий** (если задача не тривиальная)  
   Например:
   - “1) Проверяю текущий pH.  
      2) Рассчитываю дозу.  
      3) Отправляю команду на дозирование.  
      4) Жду ответ от ноды насосов.  
      5) Через 10 минут измеряю pH ещё раз.”

3. **Финальный отчёт**  
   - “Задача выполнена: pH стал 5.88. Ошибок по насосам нет.”
   - Или: “Задача не выполнена: ошибка насоса, нет тока, нода ушла в SAFE_MODE.”

Оператор должен обращать внимание на:
- сообщения об ошибках;
- предупреждения о SAFE_MODE;
- рекомендации ИИ (например, проверить насос или уровень воды).

---

## 7. Краткий чек‑лист для оператора

Перед тем как дать задачу ИИ, подумай:

1. Понятно ли, **что** нужно сделать?  
   (Коррекция pH, полив, отчёт, смена рецепта…)

2. Сказал ли ты, **где** это делать?  
   (Номер/название зоны, теплица, ёмкость.)

3. Сказал ли ты, **насколько** менять параметр?  
   (До какого pH/EC, на сколько минут полив, какая мощность света.)

4. Нужно ли указать **ограничения**?  
   (Не трогать другие зоны, не менять рецепты, не снимать защиту.)

5. Готов ли ты подтвердить действие, если ИИ скажет, что оно рискованное?

Если на все вопросы ответ “да” — задача, скорее всего, будет понятной и безопасной для ИИ и системы.
