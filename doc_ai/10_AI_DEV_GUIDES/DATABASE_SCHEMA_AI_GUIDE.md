# DATABASE_SCHEMA_AI_GUIDE.md
# Инструкция для ИИ-агентов по схеме БД (PostgreSQL)

Документ описывает правила работы ИИ-агентов с базой данных проекта.

---

## 1. Общие принципы

1. **PostgreSQL — один для всех.**
 - Laravel, Python-сервис, AI-сервисы и аналитика работают с общей БД.
2. **Laravel управляет миграциями.**
 - Никаких «ручных» DDL-запросов.
3. **Схема документируется.**
 - Изменения должны быть отражены в `../05_DATA_AND_STORAGE/DATA_MODEL_REFERENCE.md`.

---

## 2. Что можно делать ИИ-агентам

- Добавлять новые таблицы для бизнес-логики (через миграции).
- Добавлять поля в существующие таблицы, если это не ломает текущий код.
- Создавать индексы для ускорения запросов (с обоснованием).

---

## 3. Чего нельзя делать

- Удалять поля/таблицы без миграции, обсуждения и обновления документации.
- Менять типы полей в таблицах телеметрии (`telemetry_samples`, `telemetry_last`)
 без адаптации всех слоёв.
- Вводить циклические FK-зависимости.

---

## 4. Отношения с другими документами

- При добавлении сущностей:
 - описать их в `../05_DATA_AND_STORAGE/DATA_MODEL_REFERENCE.md`;
 - при необходимости — уточнить здесь, как AI может их использовать.
- AI-движок (см. `../09_AI_AND_DIGITAL_TWIN/AI_OPTIMIZATION_ENGINE.md`) может требовать дополнительные таблицы
 (например, `ai_suggestions`) — их структура описывается здесь.

---

## 5. Практические советы

- Использовать `jsonb` там, где структура данных может меняться (например, метаданные событий),
 но не злоупотреблять им в основных доменных сущностях.
- Для телеметрии — минимум полей, чёткие типы, грамотные индексы по (`zone_id`, `metric`, `ts`).

---

## 6. Резюме

ИИ-агенты могут безопасно расширять схему БД, если:

- все изменения идут через миграции;
- документация (`../05_DATA_AND_STORAGE/DATA_MODEL_REFERENCE.md`, этот файл) обновляется;
- не ломается совместимость с существующими слоями системы.
