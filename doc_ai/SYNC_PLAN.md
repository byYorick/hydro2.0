# План синхронизации проекта с документацией

Дата создания: 2025-01-27  
Цель: Привести структуру проекта в соответствие с документацией

**ВАЖНО:** Документы в `doc_ai/` являются эталоном и **не изменяются**.  
Все изменения вносятся в код, структуру проекта и конфигурационные файлы.

---

## Общая стратегия

1. **Фаза 1: Структура проекта** — привести структуру в соответствие с документацией
2. **Фаза 2: Реализация сервисов** — реализовать или удалить упомянутые сервисы
3. **Фаза 3: Создание отсутствующих компонентов** — создать скелеты и структуры
4. **Фаза 4: Проверка** — убедиться, что проект соответствует документации

---

## ФАЗА 1: Структура проекта (Высокий приоритет)

### Задача 1.1: Уточнить структуру документации в проекте

**Проблема:** В документации упоминается `docs/`, но основная документация в `doc_ai/`

**Понимание из документации:**
- `doc_ai/` — основная папка с документацией (эталон, не изменяется)
- `docs/` — упоминается в документации, возможно mirror или устаревшая структура

**Действия:**
1. Проверить наличие папки `docs/` в корне проекта
2. Если `docs/` существует, но не соответствует `doc_ai/`:
   - Создать/обновить `docs/README.md` с пояснением о назначении
   - Или синхронизировать содержимое (если это mirror)
3. Обновить `README.md` в корне проекта:
   - Указать, что `doc_ai/` — основная документация
   - Уточнить назначение `docs/` (если существует)

**Оценка:** 30 минут  
**Статус:** ⏳ Ожидает выполнения

---

### Задача 1.2: Привести api-gateway в соответствие с документацией

**Проблема:** В документации упоминается отдельный сервис `api-gateway`, но используется Laravel

**Понимание из документации:**
- Документация описывает `api-gateway/` как HTTP API для мобилки и UI
- В реальности Laravel выполняет эту роль

**Действия:**
1. Решить судьбу `backend/services/api-gateway/`:
   - Вариант А: Удалить, если Laravel полностью выполняет роль api-gateway
   - Вариант Б: Реализовать как отдельный микросервис согласно документации
   - Вариант В: Оставить как placeholder с пометкой в README
2. Обновить `backend/README.md`:
   - Указать текущую ситуацию (Laravel = api-gateway)
   - Или описать структуру api-gateway, если решено реализовать
3. Обновить `backend/docker-compose.dev.yml`:
   - Добавить сервис api-gateway, если решено реализовать
   - Или удалить упоминания, если не нужен

**Оценка:** 45 минут  
**Статус:** ⏳ Ожидает выполнения

---

### Задача 1.3: Реализовать или удалить device-registry

**Проблема:** Сервис упоминается в документации, но не реализован

**Понимание из документации:**
- `device-registry` описан как реестр устройств, хранение NodeConfig
- В реальности функционал может быть в Laravel (модели Device, DeviceNode)

**Действия:**
1. Изучить документацию по device-registry
2. Решить архитектурное решение:
   - Вариант А: Функционал в Laravel — удалить сервис из проекта
   - Вариант Б: Нужен отдельный Python-сервис — реализовать согласно документации
3. Если Вариант А:
   - Удалить `backend/services/device-registry/`
   - Удалить из `backend/docker-compose.prod.yml`
   - Обновить `backend/README.md`
4. Если Вариант Б:
   - Реализовать сервис согласно документации
   - Добавить в `backend/docker-compose.dev.yml`
   - Обновить `backend/README.md`

**Оценка:** 30 минут (Вариант А) или 4 часа (Вариант Б)  
**Статус:** ⏳ Ожидает решения

---

### Задача 1.4: Создать PYTHON_SERVICES_ARCH.md (вне doc_ai)

**Проблема:** Документ упоминается в `IMPLEMENTATION_STATUS.md`, но отсутствует

**Понимание:**
- Документация в `doc_ai/` не изменяется
- Нужно создать документ в другом месте или обновить ссылку

**Действия:**
1. Изучить упоминания `PYTHON_SERVICES_ARCH.md` в документации
2. Решить место создания:
   - Вариант А: Создать в `backend/services/` (как техническую документацию)
   - Вариант Б: Создать в `docs/` (если это mirror)
   - Вариант В: Обновить ссылку на существующий `backend/services/README.md`
3. Если создаем новый документ:
   - Описать архитектуру Python-сервисов
   - Общие компоненты (`common/`)
   - Сервисы: mqtt-bridge, history-logger, automation-engine, scheduler
   - Взаимодействие между сервисами
   - Интеграция с Laravel и MQTT
4. Обновить `backend/services/README.md` с ссылкой на документ

**Оценка:** 1-2 часа  
**Статус:** ⏳ Ожидает выполнения

---

### Задача 1.5: Создать NODE_CONFIG_SPEC.md (вне doc_ai)

**Проблема:** Документ упоминается в документации, но отсутствует

**Понимание:**
- Документация в `doc_ai/` не изменяется
- Нужно создать документ в другом месте

**Действия:**
1. Изучить существующую документацию по NodeConfig:
   - `doc_ai/02_HARDWARE_FIRMWARE/NODE_ARCH_FULL.md` (только чтение)
   - `configs/nodes/*.json` (шаблоны)
   - Упоминания в других документах
2. Создать `firmware/NODE_CONFIG_SPEC.md` или `docs/02_HARDWARE_FIRMWARE/NODE_CONFIG_SPEC.md`:
   - Структура NodeConfig (JSON/CBOR)
   - Поля конфигурации для каждого типа ноды
   - Валидация конфигурации
   - Процесс загрузки и применения конфигурации
   - Примеры конфигураций
3. Обновить `firmware/README.md` с ссылкой на документ

**Оценка:** 3 часа  
**Статус:** ⏳ Ожидает выполнения

---

## ФАЗА 2: Обновление структуры проекта (Средний приоритет)

### Задача 2.1: Привести структуру firmware в соответствие с документацией

**Проблема:** Документация описывает ноды, которых нет в проекте

**Понимание из документации:**
- Документация описывает структуру для `ph_node`, `ec_node`, `climate_node`
- В реальности есть только `pump_node` (заглушка)

**Действия:**
1. Обновить `firmware/README.md`:
   - Указать реальное состояние: только `pump_node` (заглушка)
   - Указать, что `ph_node`, `ec_node`, `climate_node` — в планах согласно документации
   - Добавить ссылку на документацию в `doc_ai/`
2. Обновить `firmware/common/components/README.md`:
   - Указать статус `PLANNED` для всех компонентов
   - Описать, что компоненты будут созданы согласно документации
   - Добавить ссылки на соответствующие документы

**Оценка:** 1 час  
**Статус:** ⏳ Ожидает выполнения

---

### Задача 2.2: Привести структуру backend/services в соответствие с документацией

**Проблема:** Документация описывает структуру с `src/`, но реальная структура проще

**Понимание из документации:**
- Документация описывает структуру с `src/` и `tests/`
- В реальности плоская структура (main.py, requirements.txt, Dockerfile)

**Действия:**
1. Изучить документацию по структуре backend/services
2. Решить:
   - Вариант А: Оставить плоскую структуру, обновить `backend/services/README.md` с пояснением
   - Вариант Б: Реорганизовать сервисы согласно документации (с `src/` и `tests/`)
3. Если Вариант А:
   - Обновить `backend/services/README.md` с описанием текущей структуры
4. Если Вариант Б:
   - Реорганизовать все сервисы (mqtt-bridge, history-logger, automation-engine, scheduler)
   - Обновить Dockerfile'ы
   - Обновить импорты
   - Обновить `backend/services/README.md`

**Оценка:** 1 час (Вариант А) или 4 часа (Вариант Б)  
**Статус:** ⏳ Ожидает решения

---

### Задача 2.3: Создать скелеты для отсутствующих нод firmware (опционально)

**Проблема:** Ноды упоминаются в документации, но отсутствуют

**Действия:**
1. Создать структуру для `ph_node/`:
   - Скопировать структуру из `pump_node/`
   - Обновить имена файлов и содержимое
   - Добавить README.md с описанием
2. Создать структуру для `ec_node/`
3. Создать структуру для `climate_node/`
4. Обновить `firmware/README.md`

**Оценка:** 2 часа  
**Статус:** ⏸️ Низкий приоритет (можно отложить)

---

## ФАЗА 3: Создание отсутствующих компонентов (Средний приоритет)

### Задача 3.1: Создать скелеты для отсутствующих нод firmware

**Проблема:** Ноды упоминаются в документации, но отсутствуют

**Понимание из документации:**
- Документация описывает структуру для `ph_node`, `ec_node`, `climate_node`
- Нужно создать скелеты согласно документации

**Действия:**
1. Изучить документацию по структуре нод
2. Создать структуру для `ph_node/`:
   - Скопировать структуру из `pump_node/`
   - Обновить имена файлов и содержимое согласно документации
   - Добавить README.md с описанием
3. Создать структуру для `ec_node/`
4. Создать структуру для `climate_node/`
5. Обновить `firmware/README.md`

**Оценка:** 2 часа  
**Статус:** ⏸️ Низкий приоритет (можно отложить)

---

## ФАЗА 4: Проверка и аудит (Низкий приоритет)

### Задача 4.1: Проверить соответствие проекта документации

**Проблема:** Нужно убедиться, что проект соответствует документации

**Действия:**
1. Проверить структуру проекта:
   - Соответствие папок документации
   - Наличие упомянутых сервисов
   - Наличие упомянутых файлов
2. Проверить реализацию:
   - Соответствие кода описанию в документации
   - Наличие функционала, описанного в документации
3. Создать отчет о несоответствиях (если есть)
4. Обновить `backend/README.md`, `firmware/README.md` и другие README с ссылками на документацию

**Оценка:** 2 часа  
**Статус:** ⏳ Ожидает выполнения

---

### Задача 4.2: Проверить соответствие структуры mobile

**Проблема:** Нужно убедиться, что структура соответствует документации

**Действия:**
1. Сравнить `doc_ai/01_SYSTEM/01_PROJECT_STRUCTURE_PROD.md` (строки 201-216) с реальной структурой
2. Проверить наличие всех упомянутых файлов/папок
3. Обновить документацию при необходимости

**Оценка:** 30 минут  
**Статус:** ⏳ Ожидает выполнения

---

## Итоговая таблица задач

| Задача | Приоритет | Оценка | Статус |
|--------|-----------|--------|--------|
| 1.1: Структура документации | Высокий | 30 мин | ⏳ |
| 1.2: api-gateway | Высокий | 45 мин | ⏳ |
| 1.3: device-registry | Высокий | 30 мин - 2ч | ⏳ |
| 1.4: PYTHON_SERVICES_ARCH.md | Высокий | 2 ч | ⏳ |
| 1.5: NODE_CONFIG_SPEC.md | Высокий | 3 ч | ⏳ |
| 2.1: Структура firmware | Средний | 1 ч | ⏳ |
| 2.2: Структура backend/services | Средний | 1-4 ч | ⏳ |
| 2.3: Скелеты нод | Низкий | 2 ч | ⏸️ |
| 3.1: IMPLEMENTATION_STATUS.md | Средний | 2 ч | ⏳ |
| 4.1: Аудит ссылок | Низкий | 3 ч | ⏳ |
| 4.2: Структура mobile | Низкий | 30 мин | ⏳ |

**Общая оценка времени:** 14-18 часов

---

## Рекомендуемый порядок выполнения

### Неделя 1: Критичные исправления документации
1. Задача 1.1 (30 мин)
2. Задача 1.2 (45 мин)
3. Задача 1.3 (30 мин - 2ч) — требует решения
4. Задача 1.4 (2 ч)
5. Задача 1.5 (3 ч)

**Итого:** ~7-9 часов

### Неделя 2: Структура и статусы
1. Задача 2.1 (1 ч)
2. Задача 2.2 (1-4 ч) — требует решения
3. Задача 3.1 (2 ч)

**Итого:** ~4-7 часов

### Неделя 3: Аудит и проверка
1. Задача 4.1 (3 ч)
2. Задача 4.2 (30 мин)
3. Задача 2.3 (2 ч) — опционально

**Итого:** ~5.5 часов

---

## Критерии завершения

Проект считается синхронизированным с документацией, когда:

- ✅ Структура проекта соответствует описанию в `doc_ai/`
- ✅ Все упомянутые сервисы либо реализованы, либо явно помечены как `PLANNED` в README
- ✅ Отсутствующие компоненты созданы согласно документации или помечены как `PLANNED`
- ✅ README файлы в проекте содержат ссылки на соответствующую документацию в `doc_ai/`
- ✅ Нет противоречий между документацией (`doc_ai/`) и структурой проекта
- ✅ Все конфигурационные файлы соответствуют описанию в документации

---

## Примечания

1. **ВАЖНО: Документация не изменяется:**
   - `doc_ai/` — эталонная документация, только для чтения
   - Все изменения вносятся в код, структуру проекта, README файлы
   - При несоответствиях приводим проект в соответствие с документацией

2. **Решения требуются:**
   - Судьба `api-gateway` (удалить или реализовать согласно документации)
   - Судьба `device-registry` (удалить или реализовать согласно документации)
   - Структура backend/services (оставить плоскую или реорганизовать с `src/`)

3. **Автоматизация:**
   - Можно создать скрипт для проверки соответствия структуры документации
   - Можно создать шаблоны для новых компонентов согласно документации

4. **Регулярность:**
   - Рекомендуется проверять соответствие проекта документации при каждом крупном изменении
   - При добавлении новых компонентов сверяться с документацией в `doc_ai/`

