# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º –≠—Ç–∞–ø–∞ 2

–î–∞—Ç–∞: 2025-12-25

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. ‚úÖ `GrowCycleService::create()` - —Å–æ–∑–¥–∞–Ω–∏–µ —Å–Ω–∞–ø—à–æ—Ç–∞ —Ñ–∞–∑—ã

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `current_phase_id` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª—Å—è –Ω–∞ `RecipeRevisionPhase` (—à–∞–±–ª–æ–Ω) –≤–º–µ—Å—Ç–æ `GrowCyclePhase` (—Å–Ω–∞–ø—à–æ—Ç)
- –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –æ—à–∏–±–∫–µ FK constraint, —Ç.–∫. FK —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ `grow_cycle_phases`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `createPhaseSnapshot()` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–Ω–∞–ø—à–æ—Ç–∞ –∏–∑ —à–∞–±–ª–æ–Ω–∞
- –í `createCycle()` —Ç–µ–ø–µ—Ä—å —Å–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å–Ω–∞–ø—à–æ—Ç —Ñ–∞–∑—ã, –∑–∞—Ç–µ–º –æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è `current_phase_id`
- –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Ü–∏–∫–ª–∞ —Å–Ω–∞–ø—à–æ—Ç –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å `grow_cycle_id`

### 2. ‚úÖ `GrowCycleService::advancePhase()` - —Å–æ–∑–¥–∞–Ω–∏–µ —Å–Ω–∞–ø—à–æ—Ç–∞ —Å–ª–µ–¥—É—é—â–µ–π —Ñ–∞–∑—ã

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `current_phase_id` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª—Å—è –Ω–∞ —à–∞–±–ª–æ–Ω –≤–º–µ—Å—Ç–æ —Å–Ω–∞–ø—à–æ—Ç–∞
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è `$currentPhase->phase_index` –¥–ª—è –ø–æ–∏—Å–∫–∞ —Å–ª–µ–¥—É—é—â–µ–π —Ñ–∞–∑—ã, –Ω–æ `$currentPhase` —ç—Ç–æ —Å–Ω–∞–ø—à–æ—Ç

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- –ü–æ–ª—É—á–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ –∏–∑ —Å–Ω–∞–ø—à–æ—Ç–∞ —á–µ—Ä–µ–∑ `$currentPhase->recipeRevisionPhase`
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `phase_index` —à–∞–±–ª–æ–Ω–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ —Å–ª–µ–¥—É—é—â–µ–π —Ñ–∞–∑—ã
- –°–æ–∑–¥–∞–Ω–∏–µ —Å–Ω–∞–ø—à–æ—Ç–∞ —Å–ª–µ–¥—É—é—â–µ–π —Ñ–∞–∑—ã –ø–µ—Ä–µ–¥ —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π `current_phase_id`

### 3. ‚úÖ `GrowCycleService::setPhase()` - —Å–æ–∑–¥–∞–Ω–∏–µ —Å–Ω–∞–ø—à–æ—Ç–∞ –Ω–æ–≤–æ–π —Ñ–∞–∑—ã

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `current_phase_id` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª—Å—è –Ω–∞ —à–∞–±–ª–æ–Ω –≤–º–µ—Å—Ç–æ —Å–Ω–∞–ø—à–æ—Ç–∞

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- –°–æ–∑–¥–∞–Ω–∏–µ —Å–Ω–∞–ø—à–æ—Ç–∞ –Ω–æ–≤–æ–π —Ñ–∞–∑—ã –ø–µ—Ä–µ–¥ —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π `current_phase_id`
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –≤ `GrowCycleTransition`

### 4. ‚úÖ `GrowCycleService::changeRecipeRevision()` - —Å–æ–∑–¥–∞–Ω–∏–µ —Å–Ω–∞–ø—à–æ—Ç–∞ –ø—Ä–∏ —Å–º–µ–Ω–µ —Ä–µ–≤–∏–∑–∏–∏

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ü—Ä–∏ —Å–º–µ–Ω–µ —Ä–µ–≤–∏–∑–∏–∏ `current_phase_id` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª—Å—è –Ω–∞ —à–∞–±–ª–æ–Ω –Ω–æ–≤–æ–π —Ä–µ–≤–∏–∑–∏–∏

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- –°–æ–∑–¥–∞–Ω–∏–µ —Å–Ω–∞–ø—à–æ—Ç–∞ –ø–µ—Ä–≤–æ–π —Ñ–∞–∑—ã –Ω–æ–≤–æ–π —Ä–µ–≤–∏–∑–∏–∏ –ø–µ—Ä–µ–¥ —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π `current_phase_id`
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤ –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –≤ `GrowCycleTransition`

### 5. ‚úÖ `GrowCycleUpdated` event - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ payload

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è `current_stage_code` –∏ `current_stage_started_at`
- –≠—Ç–∏ –ø–æ–ª—è –±—ã–ª–∏ —É–¥–∞–ª–µ–Ω—ã –≤ –º–∏–≥—Ä–∞—Ü–∏–∏

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- –ó–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ `currentPhase` —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ñ–∞–∑–µ (id, name, code)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `phase_started_at` –≤–º–µ—Å—Ç–æ `current_stage_started_at`
- –í `broadcasted()` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ `currentPhase` –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ `stage_code` —á–µ—Ä–µ–∑ `recipeRevisionPhase->stageTemplate`

## üìù –î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–π –º–µ—Ç–æ–¥

### `createPhaseSnapshot(?GrowCycle $cycle, RecipeRevisionPhase $templatePhase, ?Carbon $startedAt = null): GrowCyclePhase`

–°–æ–∑–¥–∞–µ—Ç —Å–Ω–∞–ø—à–æ—Ç —Ñ–∞–∑—ã –∏–∑ —à–∞–±–ª–æ–Ω–∞. –ö–æ–ø–∏—Ä—É–µ—Ç –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ —à–∞–±–ª–æ–Ω–∞ –≤ —Å–Ω–∞–ø—à–æ—Ç, —Å–æ—Ö—Ä–∞–Ω—è—è —Å–≤—è–∑—å —Å —à–∞–±–ª–æ–Ω–æ–º —á–µ—Ä–µ–∑ `recipe_revision_phase_id`.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `$cycle` - —Ü–∏–∫–ª (–º–æ–∂–µ—Ç –±—ã—Ç—å null –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ü–∏–∫–ª–∞)
- `$templatePhase` - —à–∞–±–ª–æ–Ω–Ω–∞—è —Ñ–∞–∑–∞
- `$startedAt` - –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ —Ñ–∞–∑—ã

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
- `GrowCyclePhase` - —Å–æ–∑–¥–∞–Ω–Ω—ã–π —Å–Ω–∞–ø—à–æ—Ç

## üîç –õ–æ–≥–∏–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤

–î–ª—è –∏—Å—Ç–æ—Ä–∏–∏ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ (`GrowCycleTransition`) –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —à–∞–±–ª–æ–Ω—ã (`RecipeRevisionPhase`), –∞ –Ω–µ —Å–Ω–∞–ø—à–æ—Ç—ã:
- –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É —à–∞–±–ª–æ–Ω–∞–º–∏, –¥–∞–∂–µ –µ—Å–ª–∏ —à–∞–±–ª–æ–Ω—ã –∏–∑–º–µ–Ω—è—é—Ç—Å—è
- –°–Ω–∞–ø—à–æ—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ü–∏–∫–ª–∞ (`current_phase_id`)
- –°–≤—è–∑—å –º–µ–∂–¥—É —Å–Ω–∞–ø—à–æ—Ç–æ–º –∏ —à–∞–±–ª–æ–Ω–æ–º —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `recipe_revision_phase_id`

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç

–í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã:
- ‚úÖ –°–Ω–∞–ø—à–æ—Ç—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∏ –ø–µ—Ä–µ—Ö–æ–¥–∞—Ö —Ü–∏–∫–ª–æ–≤
- ‚úÖ FK constraints —Ä–∞–±–æ—Ç–∞—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ Event payload –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ —à–∞–±–ª–æ–Ω—ã

