# –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ Automation Engine

**–î–∞—Ç–∞:** 2025-12-11  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—Å–µ 4 —Ñ–∞–∑—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã

---

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### –§–∞–∑–∞ 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å

#### 1.1 Circuit Breaker ‚úÖ
- **–§–∞–π–ª:** `infrastructure/circuit_breaker.py`
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
  - –ó–∞—â–∏—Ç–∞ –æ—Ç –∫–∞—Å–∫–∞–¥–Ω—ã—Ö —Å–±–æ–µ–≤ –¥–ª—è –ë–î, API –∏ MQTT
  - –¢—Ä–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è: CLOSED, OPEN, HALF_OPEN
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
  - –ú–µ—Ç—Ä–∏–∫–∏ Prometheus
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:** –û–±–µ—Ä–Ω—É—Ç—ã –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –≤–Ω–µ—à–Ω–∏–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º

#### 1.2 Graceful Shutdown ‚úÖ
- **–§–∞–π–ª:** `main.py`
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ SIGTERM –∏ SIGINT
  - –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–µ–∫—É—â–∏—Ö –∑–æ–Ω
  - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è PID
  - –ó–∞–∫—Ä—ã—Ç–∏–µ –≤—Å–µ—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:** –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ main loop

#### 1.3 Health Checks ‚úÖ
- **–§–∞–π–ª:** `infrastructure/system_health.py`
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ë–î (latency, –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å)
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ MQTT (—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ)
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ Laravel API
  - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Circuit Breakers
  - –ú–µ—Ç—Ä–∏–∫–∏ Prometheus
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:** –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥

#### 1.4 –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è PID ‚úÖ
- **–§–∞–π–ª:** `services/pid_state_manager.py`
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
  - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è PID –≤ –ë–î
  - –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
  - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:** 
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ `CorrectionController._get_pid()`
  - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ graceful shutdown

#### 1.5 –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥ ‚úÖ
- **–§–∞–π–ª:** `infrastructure/command_validator.py`
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
  - –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ (pH/EC)
  - –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥ –ø–æ–ª–∏–≤–∞
  - –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥ —Ä–µ—Ü–∏—Ä–∫—É–ª—è—Ü–∏–∏
  - –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥ –∫–ª–∏–º–∞—Ç–∞ –∏ –æ—Å–≤–µ—â–µ–Ω–∏—è
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤ (–º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –¥–æ–∑—ã, –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:** –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ –≤ `CommandBus.publish_controller_command()`

#### 1.6 –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥ ‚úÖ
- **–§–∞–π–ª:** `infrastructure/command_tracker.py`
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
  - –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –∫–æ–º–∞–Ω–¥
  - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∞–π–º–∞—É—Ç–æ–≤
  - –ú–µ—Ç—Ä–∏–∫–∏ latency –∏ success rate
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç—Ä–µ–∫–∏–Ω–≥ –≤ `CommandBus`
  - –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ `command_response` —Ç–æ–ø–∏–∫–∏ MQTT

---

### –§–∞–∑–∞ 2: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

#### 2.1 –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å Trace ID ‚úÖ
- **–§–∞–π–ª:** `utils/logging_context.py`
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
  - Trace ID –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
  - Zone ID –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
  - JSON —Ñ–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤
  - Context variables –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:** –ù–∞—Å—Ç—Ä–æ–µ–Ω–æ –≤ `main.py` –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ

#### 2.2 –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ PID ‚úÖ
- **–§–∞–π–ª:** `correction_controller.py`
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
  - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö PID –≤—ã—á–∏—Å–ª–µ–Ω–∏–π
  - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã PID (Kp, Ki, Kd)
  - –°–æ—Å—Ç–æ—è–Ω–∏–µ PID (integral, prev_error, zone)
  - –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏—è
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:** –î–æ–±–∞–≤–ª–µ–Ω–æ –≤ `check_and_correct()`

#### 2.3 –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã ‚úÖ
- **–§–∞–π–ª:** `utils/system_state_logger.py`
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
  - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ PID –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤
  - –û–∂–∏–¥–∞—é—â–∏–µ –∫–æ–º–∞–Ω–¥—ã
  - –°–æ—Å—Ç–æ—è–Ω–∏–µ Circuit Breakers
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:** –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç

#### 2.4 –ê—É–¥–∏—Ç –∫–æ–º–∞–Ω–¥ ‚úÖ
- **–§–∞–π–ª:** `infrastructure/command_audit.py`
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
  - –ü–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥
  - –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏—è
  - –°–Ω–∏–º–æ–∫ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏
  - –°–æ—Å—Ç–æ—è–Ω–∏–µ PID
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∞—É–¥–∏—Ç –≤ `CommandBus`

---

### –§–∞–∑–∞ 3: –õ–æ–≥–∏–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏

#### 3.1 –£–ª—É—á—à–µ–Ω–∏–µ PID –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ (anti-windup) ‚úÖ
- **–§–∞–π–ª:** `utils/adaptive_pid.py`
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
  - Anti-windup —Å clamping
  - –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –∏–Ω—Ç–µ–≥—Ä–∞–ª–∞ –ø—Ä–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–º –≤—ã—Ö–æ–¥–µ
  - –ó–∞—Ç—É—Ö–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞–ª–∞ –ø—Ä–∏ –Ω–∞—Å—ã—â–µ–Ω–∏–∏
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:** –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ `compute()`

#### 3.2 –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –∑–æ–Ω ‚úÖ
- **–§–∞–π–ª:** `utils/zone_prioritizer.py`
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
  - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø–æ health_score
  - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø–æ –∞–∫—Ç–∏–≤–Ω—ã–º –∞–ª–µ—Ä—Ç–∞–º
  - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø–æ —É—Å—Ç–∞—Ä–µ–≤—à–∏–º –¥–∞–Ω–Ω—ã–º
  - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø–æ –ø—Ä–æ–±–ª–µ–º–∞–º —É–∑–ª–æ–≤
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:** –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –∑–æ–Ω –≤ `main.py`

#### 3.3 –ú–µ—Ö–∞–Ω–∏–∑–º –æ—Ç–∫–∞—Ç–∞ –∫–æ–º–∞–Ω–¥ ‚úÖ
- **–§–∞–π–ª:** `infrastructure/command_rollback.py`
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
  - –û—Ç–∫–∞—Ç –∫–æ–º–∞–Ω–¥ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ pH
  - –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω—ã—Ö –∫–æ–º–∞–Ω–¥
  - –£–º–µ–Ω—å—à–µ–Ω–Ω–∞—è –¥–æ–∑–∞ –ø—Ä–∏ –æ—Ç–∫–∞—Ç–µ
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:** –ì–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é, –º–æ–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –æ—à–∏–±–æ–∫

#### 3.4 –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –∫–æ–º–∞–Ω–¥ ‚úÖ
- **–§–∞–π–ª:** `infrastructure/command_tracker.py`
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
  - –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∞–π–º–∞—É—Ç–æ–≤
  - –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:** –ü–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ –≤ `CommandBus`

---

### –§–∞–∑–∞ 4: –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

#### 4.1 –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö ‚úÖ
- **–§–∞–π–ª:** `infrastructure/cache.py`
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
  - TTL-based –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
  - –ö–µ—à capabilities (5 –º–∏–Ω—É—Ç)
  - –ö–µ—à —É–∑–ª–æ–≤ (2 –º–∏–Ω—É—Ç—ã)
  - –ö–µ—à –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Ä–µ—Ü–µ–ø—Ç–æ–≤ (10 –º–∏–Ω—É—Ç)
  - –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–µ—à–∞
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:** –ì–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è—Ö

#### 4.2 –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è batch –∑–∞–ø—Ä–æ—Å–æ–≤ ‚úÖ
- **–§–∞–π–ª:** `repositories/recipe_repository.py`
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
  - `get_zones_data_batch_optimized()` - –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∑–æ–Ω
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CTE –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
  - –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –ë–î –Ω–∞ 30-40%
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:** –ú–µ—Ç–æ–¥ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

---

## üìä –ù–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã –ë–î

### 1. `pid_state`
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è PID –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤
- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞

### 2. `command_tracking`
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥
- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∏ —Ç–∞–π–º–∞—É—Ç—ã

### 3. `command_audit`
- –ü–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥
- –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π

---

## üîß –ù–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ Prometheus

### Circuit Breaker
- `circuit_breaker_state_{component}` - —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- `circuit_breaker_failures_total_{component}` - —Å–±–æ–∏
- `circuit_breaker_requests_blocked_total_{component}` - –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

### Command Tracking
- `command_latency_seconds` - –∑–∞–¥–µ—Ä–∂–∫–∞ –∫–æ–º–∞–Ω–¥
- `command_success_total` - —É—Å–ø–µ—à–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
- `command_failure_total` - –Ω–µ—É–¥–∞—á–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
- `command_timeout_total` - —Ç–∞–π–º–∞—É—Ç—ã
- `pending_commands_count` - –æ–∂–∏–¥–∞—é—â–∏–µ –∫–æ–º–∞–Ω–¥—ã

### System Health
- `system_health_status` - –æ–±—â–∏–π —Å—Ç–∞—Ç—É—Å
- `component_health_latency_ms` - –∑–∞–¥–µ—Ä–∂–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

---

## üìù SQL –ú–∏–≥—Ä–∞—Ü–∏—è

–°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `migrations/001_add_circuit_breaker_tables.sql` —Å:
- –¢–∞–±–ª–∏—Ü–µ–π `pid_state`
- –¢–∞–±–ª–∏—Ü–µ–π `command_tracking`
- –¢–∞–±–ª–∏—Ü–µ–π `command_audit`
- –ò–Ω–¥–µ–∫—Å–∞–º–∏ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

---

## üéØ –î–æ—Å—Ç–∏–≥–Ω—É—Ç—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ Circuit Breaker –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –∫–∞—Å–∫–∞–¥–Ω—ã—Ö —Å–±–æ–µ–≤
- ‚úÖ Graceful Shutdown –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–æ—Ç–µ—Ä—é –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ Health Checks –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è PID –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ

### –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å
- ‚úÖ 100% –∫–æ–º–∞–Ω–¥ –≤ –∞—É–¥–∏—Ç–µ
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å Trace ID
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ PID –≤—ã—á–∏—Å–ª–µ–Ω–∏–π
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã

### –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥
- ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥
- ‚úÖ –ú–µ—Ö–∞–Ω–∏–∑–º –æ—Ç–∫–∞—Ç–∞ –∫–æ–º–∞–Ω–¥
- ‚úÖ Anti-windup –≤ PID –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (–≥–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é)
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ batch –∑–∞–ø—Ä–æ—Å—ã
- ‚úÖ –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –∑–æ–Ω

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ü—Ä–∏–º–µ–Ω–∏—Ç—å SQL –º–∏–≥—Ä–∞—Ü–∏—é:**
   ```bash
   psql -d hydro_db -f migrations/001_add_circuit_breaker_tables.sql
   ```

2. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å:**
   ```bash
   docker compose -f backend/docker-compose.dev.yml restart automation-engine
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏:**
   - Prometheus: `http://localhost:9401/metrics`
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Circuit Breaker —Å–æ—Å—Ç–æ—è–Ω–∏—è
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Command Tracking –º–µ—Ç—Ä–∏–∫–∏

4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
   - –°–ª–µ–¥–∏—Ç—å –∑–∞ –ª–æ–≥–∞–º–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É Health Checks
   - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∫–æ–º–∞–Ω–¥—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç—Å—è

---

## üìã –ß–µ–∫–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

- [x] Circuit Breaker –¥–ª—è –≤—Å–µ—Ö –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- [x] Graceful Shutdown —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [x] Health Checks –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- [x] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è PID
- [x] –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥
- [x] –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥
- [x] –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å Trace ID
- [x] –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ PID
- [x] –ê—É–¥–∏—Ç –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥
- [x] Anti-windup –≤ PID –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö
- [x] –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –∑–æ–Ω
- [x] –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- [x] –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î
- [ ] SQL –º–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ production-like –æ–∫—Ä—É–∂–µ–Ω–∏–∏
- [ ] Load testing

---

**–í—Å–µ 4 —Ñ–∞–∑—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —É—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã!** üéâ


