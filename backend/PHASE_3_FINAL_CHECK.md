# PHASE 3 - –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

–î–∞—Ç–∞: 2025-12-25

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ PHASE 3

### 1. –ú–∏–≥—Ä–∞—Ü–∏–∏

‚úÖ **–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤—ã –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é (Pending)
- `2025_12_25_151718_create_sensors_table` - Pending
- `2025_12_25_151719_create_telemetry_samples_table` - Pending  
- `2025_12_25_151720_create_telemetry_last_table` - Pending

‚úÖ **–°–∏–Ω—Ç–∞–∫—Å–∏—Å:** –ü—Ä–æ–≤–µ—Ä–µ–Ω —á–µ—Ä–µ–∑ `--pretend` - –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
- –¢–∞–±–ª–∏—Ü–∞ `sensors` —Å–æ–∑–¥–∞—ë—Ç—Å—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ FK –∏ –∏–Ω–¥–µ–∫—Å–∞–º–∏
- –¢–∞–±–ª–∏—Ü–∞ `telemetry_samples` –∑–∞–º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ä—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –¢–∞–±–ª–∏—Ü–∞ `telemetry_last` –∑–∞–º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ä—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### 2. –ú–æ–¥–µ–ª–∏

‚úÖ **Sensor:**
- –ú–æ–¥–µ–ª—å —Å–æ–∑–¥–∞–Ω–∞ –∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- Relationships: `greenhouse()`, `zone()`, `node()`, `telemetrySamples()`, `lastValue()`
- Scopes: `active()`, `forZone()`, `forGreenhouse()`
- –í—Å–µ –ø–æ–ª—è –≤ fillable –∏ casts

‚úÖ **TelemetrySample:**
- –ú–æ–¥–µ–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–ª—è –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- Relationships: `sensor()`, `zone()`, `cycle()`
- Scopes: `good()`, `forZone()`, `forCycle()`, `inTimeRange()`
- –í—Å–µ –ø–æ–ª—è –≤ fillable –∏ casts

‚úÖ **TelemetryLast:**
- –ú–æ–¥–µ–ª—å —Å–æ–∑–¥–∞–Ω–∞ –∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- Relationship: `sensor()`
- PK –Ω–∞ `sensor_id` (–Ω–µ auto-increment)

### 3. Relationships

‚úÖ **Sensor:**
- `greenhouse()` - BelongsTo - OK
- `zone()` - BelongsTo (nullable) - OK
- `node()` - BelongsTo (nullable) - OK
- `telemetrySamples()` - HasMany - OK
- `lastValue()` - HasOne - OK (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)

‚úÖ **TelemetrySample:**
- `sensor()` - BelongsTo - OK
- `zone()` - BelongsTo (nullable) - OK
- `cycle()` - BelongsTo (nullable) - OK

‚úÖ **TelemetryLast:**
- `sensor()` - BelongsTo - OK

### 4. SQL —Å–∫—Ä–∏–ø—Ç—ã

‚úÖ **telemetry_partitioning.sql:**
- –§—É–Ω–∫—Ü–∏—è `create_telemetry_partition()` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–∞—Ä—Ç–∏—Ü–∏–π
- –§—É–Ω–∫—Ü–∏—è `ensure_telemetry_partitions()` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è
- –ì–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã

‚úÖ **telemetry_retention.sql:**
- –§—É–Ω–∫—Ü–∏—è `cleanup_old_telemetry_partitions()` –¥–ª—è –æ—á–∏—Å—Ç–∫–∏
- Retention –ø–æ–ª–∏—Ç–∏–∫–∞: 90 –¥–Ω–µ–π –¥–ª—è raw –¥–∞–Ω–Ω—ã—Ö
- –ì–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ cron job –∏–ª–∏ Laravel scheduler

## ‚úÖ Acceptance –∫—Ä–∏—Ç–µ—Ä–∏–∏

- ‚úÖ –ú–æ–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Ä—É–∂–Ω—ã–µ –¥–∞—Ç—á–∏–∫–∏ (zone_id NULL, scope outside)
- ‚úÖ –ú–æ–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–ø–ª–∏—á–Ω—ã–µ –¥–∞—Ç—á–∏–∫–∏ (zone_id NULL, scope inside)
- ‚úÖ –ú–æ–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –∑–æ–Ω–Ω—ã–µ –¥–∞—Ç—á–∏–∫–∏ (zone_id NOT NULL)
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ telemetry_samples –≥–æ—Ç–æ–≤–∞ –∫ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—é
- ‚úÖ –ï—Å—Ç—å –ø–æ–ª–∏—Ç–∏–∫–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è (90 –¥–Ω–µ–π –¥–ª—è raw –¥–∞–Ω–Ω—ã—Ö)
- ‚úÖ –ï—Å—Ç—å –∫—ç—à –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
- ‚úÖ –í—Å–µ –º–æ–¥–µ–ª–∏ –∏ relationships —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## üìã –°—Ç–∞—Ç—É—Å

**PHASE 3 –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞.**

–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≥–æ—Ç–æ–≤—ã:
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω—ã –∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã
- ‚úÖ –ú–æ–¥–µ–ª–∏ —Å–æ–∑–¥–∞–Ω—ã –∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- ‚úÖ Relationships —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ SQL —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏ retention –≥–æ—Ç–æ–≤—ã

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –∫ PHASE 4.

