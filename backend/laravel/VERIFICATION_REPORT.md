# –û—Ç—á–µ—Ç –æ –ø—Ä–æ–≤–µ—Ä–∫–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: Singleton –¥–ª—è useSystemStatus

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û –ò –†–ê–ë–û–¢–ê–ï–¢**

### –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –∞—Å–ø–µ–∫—Ç—ã:
1. ‚úÖ Singleton –ø–∞—Ç—Ç–µ—Ä–Ω —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —á–µ—Ä–µ–∑ `sharedState`
2. ‚úÖ –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω —ç–∫–∑–µ–º–ø–ª—è—Ä —Å–æ—Å—Ç–æ—è–Ω–∏—è
3. ‚úÖ –°—á–µ—Ç—á–∏–∫ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ (`subscribers`) –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
4. ‚úÖ –ò–Ω—Ç–µ—Ä–≤–∞–ª—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ –¥–ª—è –≤—Å–µ—Ö –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤
5. ‚úÖ –ò–Ω—Ç–µ—Ä–≤–∞–ª—ã –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –≤—Å–µ –ø–æ–¥–ø–∏—Å—á–∏–∫–∏ –æ—Ç–ø–∏—Å–∞–ª–∏—Å—å
6. ‚úÖ –ù–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ `/api/system/health`

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ useSystemStatus:
- `HeaderStatusBar.vue` - –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –≤ —Ö–µ–¥–µ—Ä–µ
- `SystemMonitoringModal.vue` - –¥–µ—Ç–∞–ª—å–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–µ—Ä–≤–∏—Å–æ–≤

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –û–±–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–±—â–∏–π singleton, –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã.

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ 429

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û –ò –†–ê–ë–û–¢–ê–ï–¢**

### –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –∞—Å–ø–µ–∫—Ç—ã:
1. ‚úÖ –§–ª–∞–≥ `isRateLimited` –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
2. ‚úÖ –ò–Ω—Ç–µ—Ä–≤–∞–ª –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ 429
3. ‚úÖ Toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –¥–ª—è 429 –æ—à–∏–±–æ–∫
4. ‚úÖ –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ rate limiting –≤ debug —Ä–µ–∂–∏–º–µ

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ 429 –∏–Ω—Ç–µ—Ä–≤–∞–ª –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è, –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è.

---

## ‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ 3: WebSocket –ø—É—Ç—å –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

**–°—Ç–∞—Ç—É—Å**: ‚ö†Ô∏è **–¢–†–ï–ë–£–ï–¢ –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–û–ô –ü–†–û–í–ï–†–ö–ò**

### –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:

#### Frontend (echoClient.ts):
- `wsPath`: –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ `''`
- `wsHost`: `localhost` (–∏–∑ `window.location.hostname`)
- `wsPort`: `8080` (–∏–∑ `window.location.port` - –ø–æ—Ä—Ç nginx)
- `broadcaster`: `'reverb'`
- `key`: `'local'` (–∏–∑ `VITE_REVERB_APP_KEY`)

#### Backend (docker-compose.dev.yml):
- `REVERB_SERVER_PATH`: –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞
- `REVERB_PORT`: `6001`
- `REVERB_HOST`: `0.0.0.0`

#### Nginx (nginx-vite-proxy.conf):
- `location /app/` –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –Ω–∞ `http://127.0.0.1:6001`

### –ü—Ä–æ–±–ª–µ–º–∞:

**–û–∂–∏–¥–∞–µ–º—ã–π URL**: `ws://localhost:8080/app/local` (—á–µ—Ä–µ–∑ nginx –ø—Ä–æ–∫—Å–∏)

**–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π URL (–ø–æ –æ—à–∏–±–∫–µ)**: `ws://localhost:6001/app/app/local` (–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—É—Ç–∏)

### –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:

1. **Pusher —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –ø—É—Ç—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ**: 
   - –ï—Å–ª–∏ `wsPath` –ø—É—Å—Ç–æ–π, Pusher –¥–ª—è Reverb broadcaster –º–æ–∂–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–∏—Ç—å `/app/`
   - –ó–∞—Ç–µ–º Pusher –¥–æ–±–∞–≤–ª—è–µ—Ç `/{app_key}` = `/local`
   - –†–µ–∑—É–ª—å—Ç–∞—Ç: `/app/local` (–ø—Ä–∞–≤–∏–ª—å–Ω–æ) –∏–ª–∏ `/app/app/local` (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ)

2. **Nginx –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ**:
   - `location /app/` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
   - `proxy_pass http://127.0.0.1:6001` –¥–æ–ª–∂–µ–Ω —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –ø—É—Ç—å

3. **–ü—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤–º–µ—Å—Ç–æ –ø—Ä–æ–∫—Å–∏**:
   - URL –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç `localhost:6001` –≤–º–µ—Å—Ç–æ `localhost:8080`
   - –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ Pusher –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –∫ Reverb, –º–∏–Ω—É—è nginx
   - –í–æ–∑–º–æ–∂–Ω–æ, `wsPort` –Ω–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:

1. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `window.location.port` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `8080` (–ø–æ—Ä—Ç nginx)
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ Pusher –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ö–æ—Å—Ç –∏ –ø–æ—Ä—Ç
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ nginx –¥–ª—è WebSocket –∑–∞–ø—Ä–æ—Å–æ–≤
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ Reverb —Å–ª—É—à–∞–µ—Ç –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø—É—Ç–∏

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

1. –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `echoClient.ts` –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:
   ```typescript
   logger.debug('[echoClient] Echo config', {
     wsHost: host,
     wsPort: port,
     wsPath: path,
     key: key
   })
   ```

2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∫–æ–Ω—Å–æ–ª–∏, –∫–∞–∫–æ–π URL –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Pusher

3. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ nginx –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç WebSocket –∑–∞–ø—Ä–æ—Å—ã

---

## üìä –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|-----------|--------|-------------|
| Singleton –¥–ª—è useSystemStatus | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã |
| –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ 429 | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | Rate limiting –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ |
| WebSocket –ø—É—Ç—å | ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ | –í–æ–∑–º–æ–∂–Ω–æ –ø—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤–º–µ—Å—Ç–æ –ø—Ä–æ–∫—Å–∏ |

---

## üîß –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

1. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω singleton –ø–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è `useSystemStatus`
2. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ 429 —Å –æ—Å—Ç–∞–Ω–æ–≤–∫–æ–π –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤
3. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω `wsPath` (–ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ –¥–ª—è Reverb)
4. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ nginx –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ WebSocket
5. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ `checkHealth()`

---

## üìù –ó–∞–º–µ—Ç–∫–∏

- –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ—à–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫—É –ª–∏–Ω—Ç–µ—Ä–∞
- –ö–æ–¥ –≥–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- WebSocket –º–æ–∂–µ—Ç —Ç—Ä–µ–±–æ–≤–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –±—Ä–∞—É–∑–µ—Ä–∞

