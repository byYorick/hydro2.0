# Оптимизация производительности

## Проблемы и решения

### 1. Медленная загрузка главной страницы
**Проблема**: Множественные запросы к БД без кеширования

**Решение**:
- Добавлено кеширование данных дашборда на 30 секунд
- Оптимизированы запросы: объединены COUNT запросы в один
- Заменен `whereHas` на `JOIN` для проблемных зон
- Используется `selectOne` вместо `getPdo()` для health check

### 2. Медленный health endpoint
**Проблема**: `getPdo()` может быть медленным при первом подключении

**Решение**:
- Используется `selectOne('SELECT 1')` вместо `getPdo()`
- Добавлен таймаут подключения к БД (2 секунды)

### 3. Оптимизация запросов
- Использование `JOIN` вместо `whereHas` для лучшей производительности
- Кеширование статических данных
- Eager loading для связанных моделей

## Рекомендации

1. **Кеширование**: Используйте Redis для кеширования в production
2. **Индексы**: Убедитесь, что все внешние ключи и часто используемые поля имеют индексы
3. **Мониторинг**: Используйте Laravel Debugbar или Telescope для отслеживания медленных запросов
4. **Оптимизация БД**: Регулярно выполняйте `VACUUM ANALYZE` для PostgreSQL

## Проверка производительности

```bash
# Проверка времени ответа health endpoint
docker exec backend-laravel-1 curl -w '\nTime: %{time_total}s\n' http://localhost/api/system/health

# Очистка кеша
docker exec backend-laravel-1 php artisan cache:clear
docker exec backend-laravel-1 php artisan config:clear
```

