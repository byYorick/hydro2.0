# EC Node

EC-нода для измерения электропроводности и управления четырьмя насосами питания.

## Используемый сенсор

Нода использует **Trema EC-сенсор (iarduino)** через I²C:
- Компонент: `trema_ec`
- I²C адрес: 0x08
- Поддержка калибровки (2 этапа)
- Температурная компенсация
- Измерение EC (mS/cm) и TDS (ppm)

## Описание

Нода измеряет EC (электропроводность) раствора и управляет 4 насосами для внесения компонентов питания.

## Каналы

### Сенсоры
- `ec_sensor` - датчик EC

### Актуаторы
- `pump_a` - насос компонента A (NPK)
- `pump_b` - насос компонента B (Ca)
- `pump_c` - насос компонента C (Mg)
- `pump_d` - насос компонента D (Micro)

## Команды

### run_pump
Запуск насоса на указанное время:
```json
{
  "cmd": "run_pump",
  "cmd_id": "cmd-123",
  "params": {
    "duration_ms": 2000
  }
}
```

### calibrate
Калибровка EC датчика (2 этапа):
```json
{
  "cmd": "calibrate",
  "cmd_id": "cmd-124",
  "params": {
    "stage": 1,
    "tds_value": 1413
  }
}
```

Этапы калибровки:
- **Этап 1**: калибровка на известное TDS значение (например, 1413 ppm - стандартный раствор)
- **Этап 2**: калибровка на другое TDS значение (например, 2764 ppm)

После отправки команды калибровки нода отвечает статусом ACK или ERROR.

## Документация

- Архитектура нод: `../../../doc_ai/02_HARDWARE_FIRMWARE/NODE_ARCH_FULL.md`
- MQTT спецификация: `../../../doc_ai/03_TRANSPORT_MQTT/MQTT_SPEC_FULL.md`
- NodeConfig: `../../NODE_CONFIG_SPEC.md`
