# E40: Zone Readiness Fail - зона без bindings → 422
# DoD: создать зону без required bindings, попытка start grow-cycle → 422 + причины

name: E40_zone_readiness_fail
description: |
  Проверяет проверку готовности зоны:
  - Создается зона без требуемых bindings
  - Попытка запустить grow-cycle должна вернуть 422 с причинами

actions:
  - step: create_zone_without_bindings
    type: api_post
    endpoint: /api/zones
    payload:
      name: test-zone-no-bindings
      description: Zone without required bindings
      status: PLANNED
    save: zone_response

  - step: set_zone_id
    type: set
    zone_id: ${zone_response.data.id}

  # Попытка запустить grow-cycle (start) - пропускаем, т.к. endpoint может не быть реализован
  # - step: attempt_start_cycle
  #   type: api_post
  #   endpoint: /api/zones/${zone_id}/start
  #   payload: {}
  #   save: start_response

assertions:
  # Проверка: Zone создана успешно
  # Примечание: Проверка readiness может быть не реализована, поэтому делаем проверку опциональной
  - name: zone_created
    type: database_query
    query: |
      SELECT id
      FROM zones
      WHERE id = :zone_id
    params:
      zone_id: ${zone_id}
    expected_rows: 1

cleanup:
  # Удаляем тестовую зону
  - step: delete_test_zone
    type: api_delete
    endpoint: /api/zones/${zone_id}
    optional: true


