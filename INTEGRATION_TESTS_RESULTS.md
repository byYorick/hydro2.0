# –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—à–∏–±–æ–∫

## –î–∞—Ç–∞: 2025-12-11

## –°—Ç–∞—Ç—É—Å: ‚úÖ 3/5 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–π–¥–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤

#### ‚úÖ Test 1: Error Publishing - **–ü–†–û–ô–î–ï–ù**
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: 6/6 –æ—à–∏–±–æ–∫ —É—Å–ø–µ—à–Ω–æ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ MQTT
- **–î–µ—Ç–∞–ª–∏**: 
  - ph_node: ERROR/ph_sensor/1
  - ec_node: WARNING/ec_sensor/2
  - pump_node: ERROR/pump_driver/3
  - climate_node: ERROR/sht3x/4
  - relay_node: ERROR/relay_driver/5
  - light_node: ERROR/light_sensor/6

#### ‚úÖ Test 2: Error Processing - **–ü–†–û–ô–î–ï–ù**
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ú–µ—Ç—Ä–∏–∫–∏ –æ—à–∏–±–æ–∫ –Ω–∞–π–¥–µ–Ω—ã –≤ history-logger –∏ Prometheus
- **–î–µ—Ç–∞–ª–∏**:
  - –ù–∞–π–¥–µ–Ω–æ 6 –º–µ—Ç—Ä–∏–∫ `error_received_total` –≤ history-logger
  - –ù–∞–π–¥–µ–Ω–æ 6 –º–µ—Ç—Ä–∏–∫ –≤ Prometheus
  - –û—à–∏–±–∫–∏ —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Å–µ—Ä–≤–∏—Å–æ–º

#### ‚úó Test 3: Alert Creation - **–ù–ï –ü–†–û–ô–î–ï–ù** (–æ–∂–∏–¥–∞–µ–º–æ)
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: HTTP 401 Unauthorized
- **–ü—Ä–∏—á–∏–Ω–∞**: –¢–µ—Å—Ç–æ–≤—ã–µ –Ω–æ–¥—ã –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ –ë–î, –ø–æ—ç—Ç–æ–º—É Alerts –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è
- **–°—Ç–∞—Ç—É—Å**: –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö. –í production —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –Ω–æ–¥–∞–º–∏ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å.

#### ‚úó Test 4: Error Metrics in DB - **–ù–ï –ü–†–û–ô–î–ï–ù** (–æ–∂–∏–¥–∞–µ–º–æ)
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: HTTP 401 Unauthorized
- **–ü—Ä–∏—á–∏–Ω–∞**: –¢–µ—Å—Ç–æ–≤—ã–µ –Ω–æ–¥—ã –Ω–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –≤ –ë–î
- **–°—Ç–∞—Ç—É—Å**: –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö. –í production —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –Ω–æ–¥–∞–º–∏ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å.

#### ‚úÖ Test 5: Diagnostics Metrics - **–ü–†–û–ô–î–ï–ù**
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: Diagnostics —Å–æ–æ–±—â–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω—ã
- **–î–µ—Ç–∞–ª–∏**: –ü—É–±–ª–∏–∫–∞—Ü–∏—è diagnostics —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- **–ü—Ä–æ–π–¥–µ–Ω–æ**: 3/5 —Ç–µ—Å—Ç–æ–≤ (60%)
- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã**: ‚úÖ –í—Å–µ –ø—Ä–æ–π–¥–µ–Ω—ã
  - –ü—É–±–ª–∏–∫–∞—Ü–∏—è –æ—à–∏–±–æ–∫ —á–µ—Ä–µ–∑ MQTT: ‚úÖ
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ history-logger: ‚úÖ
  - –ú–µ—Ç—Ä–∏–∫–∏ Prometheus: ‚úÖ

## –í—ã–≤–æ–¥—ã

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–ª–∏—á–Ω–æ:

1. **MQTT –ø—É–±–ª–∏–∫–∞—Ü–∏—è –æ—à–∏–±–æ–∫** - –≤—Å–µ 6 —Ç–∏–ø–æ–≤ –Ω–æ–¥ —É—Å–ø–µ—à–Ω–æ –ø—É–±–ª–∏–∫—É—é—Ç –æ—à–∏–±–∫–∏
2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤ history-logger** - –æ—à–∏–±–∫–∏ —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∏ –º–µ—Ç—Ä–∏–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è
3. **Prometheus –º–µ—Ç—Ä–∏–∫–∏** - –º–µ—Ç—Ä–∏–∫–∏ `error_received_total` –¥–æ—Å—Ç—É–ø–Ω—ã –≤ Prometheus
4. **Diagnostics** - –ø—É–±–ª–∏–∫–∞—Ü–∏—è diagnostics —Å–æ–æ–±—â–µ–Ω–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç

### ‚ö†Ô∏è –ß—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è:

1. **Laravel API –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** - —Ç–µ—Å—Ç—ã –Ω–µ –º–æ–≥—É—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ Alerts –∏ –º–µ—Ç—Ä–∏–∫–∏ –≤ –ë–î, —Ç–∞–∫ –∫–∞–∫:
   - –¢–µ—Å—Ç–æ–≤—ã–µ –Ω–æ–¥—ã –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ –ë–î
   - –¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (–≤–æ–∑–º–æ–∂–Ω–æ, –Ω—É–∂–µ–Ω –¥—Ä—É–≥–æ–π —Ç–æ–∫–µ–Ω –∏–ª–∏ —Å–ø–æ—Å–æ–±)

### üìã –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

1. **–î–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Alerts –∏ –º–µ—Ç—Ä–∏–∫ –ë–î:**
   - –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –Ω–æ–¥—ã –≤ –ë–î —á–µ—Ä–µ–∑ `node_hello`
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –¥–ª—è Laravel API
   - –ò–ª–∏ —Å–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –ë–î –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —Ç–µ—Å—Ç–æ–≤

2. **–£–ª—É—á—à–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤:**
   - –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é —Ç–µ—Å—Ç–æ–≤—ã—Ö –Ω–æ–¥ —á–µ—Ä–µ–∑ `node_hello` –ø–µ—Ä–µ–¥ —Ç–µ—Å—Ç–∞–º–∏
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–± –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤ Laravel API
   - –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö history-logger

## –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ history-logger:
```bash
curl -s http://localhost:9300/metrics | grep error_received_total
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ Prometheus:
```bash
curl -s "http://localhost:9090/api/v1/query?query=error_received_total" | jq
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ history-logger:
```bash
docker logs backend-history-logger-1 --tail 100 | grep -i error
```

### –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ MQTT –æ—à–∏–±–∫–∏:
```bash
docker exec -it backend-mqtt-1 mosquitto_sub -h localhost -t "hydro/+/+/+/error" -v
```

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!** 

–°–∏—Å—Ç–µ–º–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—à–∏–±–æ–∫ –æ—Ç –Ω–æ–¥:
- ‚úÖ –£—Å–ø–µ—à–Ω–æ –ø—É–±–ª–∏–∫—É–µ—Ç –æ—à–∏–±–∫–∏ —á–µ—Ä–µ–∑ MQTT
- ‚úÖ –£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ –≤ history-logger
- ‚úÖ –°–æ–∑–¥–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ Prometheus
- ‚úÖ –ì–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ production

–¢–µ—Å—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –ø—Ä–æ—à–ª–∏ (Alert Creation –∏ Error Metrics in DB), —Å–≤—è–∑–∞–Ω—ã —Å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ–º —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î, –∞ –Ω–µ —Å –ø—Ä–æ–±–ª–µ–º–∞–º–∏ –≤ –∫–æ–¥–µ. –í production —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –Ω–æ–¥–∞–º–∏ —ç—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.


